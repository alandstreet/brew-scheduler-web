import{b6 as w,at as Ae,b7 as L,b8 as $}from"./index-BeZvCyrH.js";var E;(function(e){e.NoEndpointId="NoEndpointId",e.PlatformNotSupported="PlatformNotSupported",e.Unknown="Unknown",e.NetworkError="NetworkError"})(E||(E={}));const he=(e,t=w)=>(n,o,r)=>{const{message:s,recoverySuggestion:a}=e[o];if(!n)throw new t({name:o,message:r?`${s} ${r}`:s,recoverySuggestion:a})},Un=()=>{if(typeof window=="object"&&typeof window.crypto=="object")return window.crypto;if(typeof crypto=="object")return crypto;throw new w({name:"MissingPolyfill",message:"Cannot resolve the `crypto` function from the environment."})},xn=()=>{if(typeof window<"u"&&typeof window.btoa=="function")return window.btoa;if(typeof btoa=="function")return btoa;throw new w({name:"Base64EncoderError",message:"Cannot resolve the `btoa` function from the environment."})},Me=()=>{if(typeof window<"u"&&typeof window.atob=="function")return window.atob;if(typeof atob=="function")return atob;throw new w({name:"Base64EncoderError",message:"Cannot resolve the `atob` function from the environment."})},De={convert(e,t){let n=e;return t?.urlSafe&&(n=n.replace(/-/g,"+").replace(/_/g,"/")),Me()(n)}};var S;(function(e){e.AuthTokenConfigException="AuthTokenConfigException",e.AuthUserPoolAndIdentityPoolException="AuthUserPoolAndIdentityPoolException",e.AuthUserPoolException="AuthUserPoolException",e.InvalidIdentityPoolIdException="InvalidIdentityPoolIdException",e.OAuthNotConfigureException="OAuthNotConfigureException"})(S||(S={}));const _e={[S.AuthTokenConfigException]:{message:"Auth Token Provider not configured.",recoverySuggestion:"Make sure to call Amplify.configure in your app."},[S.AuthUserPoolAndIdentityPoolException]:{message:"Auth UserPool or IdentityPool not configured.",recoverySuggestion:"Make sure to call Amplify.configure in your app with UserPoolId and IdentityPoolId."},[S.AuthUserPoolException]:{message:"Auth UserPool not configured.",recoverySuggestion:"Make sure to call Amplify.configure in your app with userPoolId and userPoolClientId."},[S.InvalidIdentityPoolIdException]:{message:"Invalid identity pool id provided.",recoverySuggestion:"Make sure a valid identityPoolId is given in the config."},[S.OAuthNotConfigureException]:{message:"oauth param not configured.",recoverySuggestion:"Make sure to call Amplify.configure with oauth parameter in your app."}},O=he(_e);function f(e){let t=!0;e?t=!!e.userPoolId&&!!e.userPoolClientId:t=!1,O(t,S.AuthUserPoolException)}function bn(e){const t=!!e?.loginWith?.oauth?.domain&&!!e?.loginWith?.oauth?.redirectSignOut&&!!e?.loginWith?.oauth?.redirectSignIn&&!!e?.loginWith?.oauth?.responseType;O(t,S.OAuthNotConfigureException)}function An(e){const t=!!e?.identityPoolId;O(t,S.InvalidIdentityPoolIdException)}function R(e){const t=e.split(".");if(t.length!==3)throw new Error("Invalid token");try{const o=t[1].replace(/-/g,"+").replace(/_/g,"/"),r=decodeURIComponent(De.convert(o).split("").map(a=>`%${`00${a.charCodeAt(0).toString(16)}`.slice(-2)}`).join("")),s=JSON.parse(r);return{toString:()=>e,payload:s}}catch{throw new Error("Invalid token payload")}}const l=[];for(let e=0;e<256;++e)l.push((e+256).toString(16).slice(1));function Ke(e,t=0){return(l[e[t+0]]+l[e[t+1]]+l[e[t+2]]+l[e[t+3]]+"-"+l[e[t+4]]+l[e[t+5]]+"-"+l[e[t+6]]+l[e[t+7]]+"-"+l[e[t+8]]+l[e[t+9]]+"-"+l[e[t+10]]+l[e[t+11]]+l[e[t+12]]+l[e[t+13]]+l[e[t+14]]+l[e[t+15]]).toLowerCase()}let A;const Oe=new Uint8Array(16);function Ne(){if(!A){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");A=crypto.getRandomValues.bind(crypto)}return A(Oe)}const Ve=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),W={randomUUID:Ve};function Le(e,t,n){if(W.randomUUID&&!t&&!e)return W.randomUUID();e=e||{};const o=e.random??e.rng?.()??Ne();if(o.length<16)throw new Error("Random bytes length must be >= 16");if(o[6]=o[6]&15|64,o[8]=o[8]&63|128,t){if(n=n||0,n<0||n+16>t.length)throw new RangeError(`UUID byte range ${n}:${n+15} is out of buffer bounds`);for(let r=0;r<16;++r)t[n+r]=o[r];return t}return Ke(o)}var u;(function(e){e.WebUnknown="0",e.React="1",e.NextJs="2",e.Angular="3",e.VueJs="4",e.Nuxt="5",e.Svelte="6",e.ServerSideUnknown="100",e.ReactSSR="101",e.NextJsSSR="102",e.AngularSSR="103",e.VueJsSSR="104",e.NuxtSSR="105",e.SvelteSSR="106",e.ReactNative="201",e.Expo="202"})(u||(u={}));var F;(function(e){e.AI="ai",e.API="api",e.Auth="auth",e.Analytics="analytics",e.DataStore="datastore",e.Geo="geo",e.InAppMessaging="inappmessaging",e.Interactions="interactions",e.Predictions="predictions",e.PubSub="pubsub",e.PushNotification="pushnotification",e.Storage="storage"})(F||(F={}));var j;(function(e){e.CreateConversation="1",e.GetConversation="2",e.ListConversations="3",e.DeleteConversation="4",e.SendMessage="5",e.ListMessages="6",e.OnMessage="7",e.Generation="8",e.UpdateConversation="9"})(j||(j={}));var z;(function(e){e.Record="1",e.IdentifyUser="2"})(z||(z={}));var G;(function(e){e.GraphQl="1",e.Get="2",e.Post="3",e.Put="4",e.Patch="5",e.Del="6",e.Head="7"})(G||(G={}));var H;(function(e){e.SignUp="1",e.ConfirmSignUp="2",e.ResendSignUpCode="3",e.SignIn="4",e.FetchMFAPreference="6",e.UpdateMFAPreference="7",e.SetUpTOTP="10",e.VerifyTOTPSetup="11",e.ConfirmSignIn="12",e.DeleteUserAttributes="15",e.DeleteUser="16",e.UpdateUserAttributes="17",e.FetchUserAttributes="18",e.ConfirmUserAttribute="22",e.SignOut="26",e.UpdatePassword="27",e.ResetPassword="28",e.ConfirmResetPassword="29",e.FederatedSignIn="30",e.RememberDevice="32",e.ForgetDevice="33",e.FetchDevices="34",e.SendUserAttributeVerificationCode="35",e.SignInWithRedirect="36",e.StartWebAuthnRegistration="37",e.CompleteWebAuthnRegistration="38",e.ListWebAuthnCredentials="39",e.DeleteWebAuthnCredential="40"})(H||(H={}));var B;(function(e){e.Subscribe="1",e.GraphQl="2"})(B||(B={}));var J;(function(e){e.SearchByText="0",e.SearchByCoordinates="1",e.SearchForSuggestions="2",e.SearchByPlaceId="3",e.SaveGeofences="4",e.GetGeofence="5",e.ListGeofences="6",e.DeleteGeofences="7"})(J||(J={}));var q;(function(e){e.SyncMessages="1",e.IdentifyUser="2",e.NotifyMessageInteraction="3"})(q||(q={}));var X;(function(e){e.None="0"})(X||(X={}));var Y;(function(e){e.Convert="1",e.Identify="2",e.Interpret="3"})(Y||(Y={}));var Q;(function(e){e.Subscribe="1"})(Q||(Q={}));var Z;(function(e){e.InitializePushNotifications="1",e.IdentifyUser="2"})(Z||(Z={}));var ee;(function(e){e.UploadData="1",e.DownloadData="2",e.List="3",e.Copy="4",e.Remove="5",e.GetProperties="6",e.GetUrl="7",e.GetDataAccess="8",e.ListCallerAccessGrants="9"})(ee||(ee={}));const $e="6.15.8",U=()=>typeof global<"u",T=()=>typeof window<"u",ge=()=>typeof document<"u",N=()=>typeof process<"u",P=(e,t)=>!!Object.keys(e).find(n=>n.startsWith(t));var te={};function We(){const e=o=>o.startsWith("_react")||o.startsWith("__react"),t=o=>Object.keys(o).find(e),n=()=>Array.from(document.querySelectorAll("[id]"));return ge()&&n().some(t)}function Fe(){return N()&&typeof te<"u"&&!!Object.keys(te).find(e=>e.includes("react"))}function je(){return T()&&P(window,"__VUE")}function ze(){return U()&&P(global,"__VUE")}var ne={};function Ge(){return T()&&P(window,"__SVELTE")}function He(){return N()&&typeof ne<"u"&&!!Object.keys(ne).find(e=>e.includes("svelte"))}function Be(){return T()&&window.next&&typeof window.next=="object"}function Je(){return U()&&(P(global,"__next")||P(global,"__NEXT"))}function qe(){return T()&&(window.__NUXT__!==void 0||window.$nuxt!==void 0)}function Xe(){return U()&&typeof global.__NUXT_PATHS__<"u"}var oe={};function Ye(){const e=!!(ge()&&document.querySelector("[ng-version]")),t=!!(T()&&typeof window.ng<"u");return e||t}function Qe(){return N()&&typeof oe=="object"&&oe.npm_lifecycle_script?.startsWith("ng ")||!1}function Ze(){return typeof navigator<"u"&&typeof navigator.product<"u"&&navigator.product==="ReactNative"}function et(){return U()&&typeof global.expo<"u"}function tt(){return T()}const nt=[{platform:u.Expo,detectionMethod:et},{platform:u.ReactNative,detectionMethod:Ze},{platform:u.NextJs,detectionMethod:Be},{platform:u.Nuxt,detectionMethod:qe},{platform:u.Angular,detectionMethod:Ye},{platform:u.React,detectionMethod:We},{platform:u.VueJs,detectionMethod:je},{platform:u.Svelte,detectionMethod:Ge},{platform:u.WebUnknown,detectionMethod:tt},{platform:u.NextJsSSR,detectionMethod:Je},{platform:u.NuxtSSR,detectionMethod:Xe},{platform:u.ReactSSR,detectionMethod:Fe},{platform:u.VueJsSSR,detectionMethod:ze},{platform:u.AngularSSR,detectionMethod:Qe},{platform:u.SvelteSSR,detectionMethod:He}];function ot(){return nt.find(e=>e.detectionMethod())?.platform||u.ServerSideUnknown}let k;const M=[];let _=!1;const rt=10,st=10,at=1e3,fe=()=>{if(!k){if(k=ot(),_)for(;M.length;)M.pop()?.();else M.forEach(e=>{e()});re(u.ServerSideUnknown,rt),re(u.WebUnknown,st)}return k};function it(){k=void 0}function re(e,t){k===e&&!_&&setTimeout(()=>{it(),_=!0,setTimeout(fe,at)},t)}const ct={},ut=(e,t)=>ct[e]?.[t]?.additionalDetails,dt="aws-amplify",lt=e=>e.replace(/\+.*/,""),ht=({category:e,action:t}={})=>{const n=[[dt,lt($e)]];if(e&&n.push([e,t]),n.push(["framework",fe()]),e&&t){const o=ut(e,t);o&&o.forEach(r=>{n.push(r)})}return n},gt=e=>ht(e).map(([o,r])=>o&&r?`${o}/${r}`:o).join(" "),ft=()=>typeof window<"u"&&typeof window.document<"u",me=e=>{const{headers:t,statusCode:n}=e;return{...mt(e)?e.$metadata:{},httpStatusCode:n,requestId:t["x-amzn-requestid"]??t["x-amzn-request-id"]??t["x-amz-request-id"],extendedRequestId:t["x-amz-id-2"],cfId:t["x-amz-cf-id"]}},mt=e=>typeof e?.$metadata=="object",ye=async e=>{if(!e||e.statusCode<300)return;const t=await pe(e),o=(a=>{const[i]=a.toString().split(/[,:]+/);return i.includes("#")?i.split("#")[1]:i})(e.headers["x-amzn-errortype"]??t.code??t.__type??"UnknownError"),r=t.message??t.Message??"Unknown error",s=new Error(r);return Object.assign(s,{name:o,$metadata:me(e)})},pe=async e=>{if(!e.body)throw new Error("Missing response payload");const t=await e.body.json();return Object.assign(t,{$metadata:me(e)})},yt=(e,t,n,o)=>async(r,s)=>{const a={...o,...r},i=await a.endpointResolver(a,s),h=await t(s,i),c=await e(h,{...a});return n(c)},pt=300*1e3;function St(e=pt){return o=>{const r=2**o*100+100*Math.random();return r>e?!1:r}}const Se=3,se="amz-sdk-invocation-id",wt="amz-sdk-request",ae=300*1e3,It=e=>{const n=St(ae)(e);return n===!1?ae:n},Et=["AuthFailure","InvalidSignatureException","RequestExpired","RequestInTheFuture","RequestTimeTooSkewed","SignatureDoesNotMatch","BadRequestException"],Tt=e=>!!e&&Et.includes(e),vt=e=>async(t,n)=>{const o=n??await e(t)??void 0,r=o?.code||o?.name,s=t?.statusCode;return{retryable:Ct(n)||Rt(s,r)||Tt(r)||Ut(s,r)}},kt=["BandwidthLimitExceeded","EC2ThrottledException","LimitExceededException","PriorRequestNotComplete","ProvisionedThroughputExceededException","RequestLimitExceeded","RequestThrottled","RequestThrottledException","SlowDown","ThrottledException","Throttling","ThrottlingException","TooManyRequestsException"],Pt=["TimeoutError","RequestTimeout","RequestTimeoutException"],Rt=(e,t)=>e===429||!!t&&kt.includes(t),Ct=e=>[E.NetworkError,"ERR_NETWORK"].includes(e?.name),Ut=(e,t)=>!!e&&[500,502,503,504].includes(e)||!!t&&Pt.includes(t),xt=({maxAttempts:e=Se,retryDecider:t,computeDelay:n,abortSignal:o})=>{if(e<1)throw new Error("maxAttempts must be greater than 0");return(r,s)=>async function(i){let h,c=s.attemptsCount??0,g;const m=()=>{if(g)return ie(g,c),g;throw ie(h,c),h};for(;!o?.aborted&&c<e;){try{g=await r(i),h=void 0}catch(b){h=b,g=void 0}c=(s.attemptsCount??0)>c?s.attemptsCount??0:c+1,s.attemptsCount=c;const{isCredentialsExpiredError:I,retryable:x}=await t(g,h,s);if(x){if(s.isCredentialsExpired=!!I,!o?.aborted&&c<e){const b=n(c);await bt(b,o)}continue}else return m()}if(o?.aborted)throw new Error("Request aborted.");return m()}},bt=(e,t)=>{if(t?.aborted)return Promise.resolve();let n,o;const r=new Promise(s=>{o=s,n=setTimeout(s,e)});return t?.addEventListener("abort",function s(a){clearTimeout(n),t?.removeEventListener("abort",s),o()}),r},ie=(e,t)=>{Object.prototype.toString.call(e)==="[object Object]"&&(e.$metadata={...e.$metadata??{},attempts:t})},At=Le,Mt=()=>e=>async function(n){return n.headers[se]||(n.headers[se]=At()),e(n)},Dt=({maxAttempts:e=Se})=>(t,n)=>async function(r){const s=n.attemptsCount??0;return r.headers[wt]=`attempt=${s+1}; max=${e}`,t(r)},_t=({userAgentHeader:e="x-amz-user-agent",userAgentValue:t=""})=>n=>async function(r){if(t.trim().length===0)return await n(r);{const s=e.toLowerCase();return r.headers[s]=r.headers[s]?`${r.headers[s]} ${t}`:t,await n(r)}},we=(e,t)=>(n,o)=>{const r={};let s=a=>e(a,o);for(let a=t.length-1;a>=0;a--){const i=t[a];s=i(o)(s,r)}return s(n)},D=e=>{let t;return()=>(t||(t=e()),t)},Kt=e=>!["HEAD","GET"].includes(e.toUpperCase()),Ot=async({url:e,method:t,headers:n,body:o},{abortSignal:r,cache:s,withCrossDomainCredentials:a})=>{let i;try{i=await fetch(e,{method:t,headers:n,body:Kt(t)?o:void 0,signal:r,cache:s,credentials:a?"include":"same-origin"})}catch(m){throw m instanceof TypeError?new w({name:E.NetworkError,message:"A network error has occurred.",underlyingError:m}):m}const h={};i.headers?.forEach((m,I)=>{h[I.toLowerCase()]=m});const c={statusCode:i.status,headers:h,body:null},g=Object.assign(i.body??{},{text:D(()=>i.text()),blob:D(()=>i.blob()),json:D(()=>i.json())});return{...c,body:g}},Nt=we(Ot,[_t,Mt,xt,Dt]),Ie={id:"aws",outputs:{dnsSuffix:"amazonaws.com"},regionRegex:"^(us|eu|ap|sa|ca|me|af)\\-\\w+\\-\\d+$",regions:["aws-global"]},Vt={partitions:[Ie,{id:"aws-cn",outputs:{dnsSuffix:"amazonaws.com.cn"},regionRegex:"^cn\\-\\w+\\-\\d+$",regions:["aws-cn-global"]}]},Lt=e=>{const{partitions:t}=Vt;for(const{regions:n,outputs:o,regionRegex:r}of t){const s=new RegExp(r);if(n.includes(e)||s.test(e))return o.dnsSuffix}return Ie.outputs.dnsSuffix},Ee=URL;class v extends w{constructor(){super({name:E.PlatformNotSupported,message:"Function not supported on current platform"})}}class Te{constructor(t){this.storage=t}async setItem(t,n){if(!this.storage)throw new v;this.storage.setItem(t,n)}async getItem(t){if(!this.storage)throw new v;return this.storage.getItem(t)}async removeItem(t){if(!this.storage)throw new v;this.storage.removeItem(t)}async clear(){if(!this.storage)throw new v;this.storage.clear()}}class ve{constructor(){this.storage=new Map}get length(){return this.storage.size}key(t){return t>this.length-1?null:Array.from(this.storage.keys())[t]}setItem(t,n){this.storage.set(t,n)}getItem(t){return this.storage.get(t)??null}removeItem(t){this.storage.delete(t)}clear(){this.storage.clear()}}const ke=new Ae("CoreStorageUtils"),$t=()=>{try{if(typeof window<"u"&&window.localStorage)return window.localStorage}catch{ke.info("localStorage not found. InMemoryStorage is used as a fallback.")}return new ve},Pe=()=>{try{if(typeof window<"u"&&window.sessionStorage)return window.sessionStorage.getItem("test"),window.sessionStorage;throw new Error("sessionStorage is not defined")}catch{return ke.info("sessionStorage not found. InMemoryStorage is used as a fallback."),new ve}};class Wt extends Te{constructor(){super($t())}}class Ft extends Te{constructor(){super(Pe())}}class jt{constructor(t){this._storage=t}get storage(){if(!this._storage)throw new v;return this._storage}setItem(t,n){this.storage.setItem(t,n)}getItem(t){return this.storage.getItem(t)}removeItem(t){this.storage.removeItem(t)}clear(){this.storage.clear()}}class zt extends jt{constructor(){super(Pe())}}const Re=new Wt;new Ft;new zt;const Gt=e=>{let t;return async(...n)=>t||(t=new Promise((o,r)=>{e(...n).then(s=>{o(s)}).catch(s=>{r(s)}).finally(()=>{t=void 0})}),t)};function ce({expiresAt:e,clockDrift:t,tolerance:n=5e3}){return Date.now()+t+n>e}class d extends w{constructor(t){super(t),this.constructor=d,Object.setPrototypeOf(this,d.prototype)}}function Ht(e){const t=e?.split("_")[0];if(!e||e.indexOf("_")<0||!t||typeof t!="string")throw new d({name:"InvalidUserPoolId",message:"Invalid user pool id provided."});return t}function Mn(e){if(!e||!e.includes(":"))throw new d({name:"InvalidIdentityPoolIdException",message:"Invalid identity pool id provided.",recoverySuggestion:"Make sure a valid identityPoolId is given in the config."});return e.split(":")[0]}const V="UserUnAuthenticatedException",Dn="UserAlreadyAuthenticatedException",Bt="InvalidRedirectException",Jt="InvalidAppSchemeException",qt="InvalidPreferredRedirectUrlException",_n=new d({name:Bt,message:"signInRedirect or signOutRedirect had an invalid format or was not found.",recoverySuggestion:"Please make sure the signIn/Out redirect in your oauth config is valid."});new d({name:Jt,message:"A valid non-http app scheme was not found in the config.",recoverySuggestion:"Please make sure a valid custom app scheme is present in the config."});new d({name:qt,message:"The given preferredRedirectUrl does not match any items in the redirectSignOutUrls array from the config.",recoverySuggestion:"Please make sure a matching preferredRedirectUrl is provided."});const Xt="InvalidOriginException",Kn=new d({name:Xt,message:"redirect is coming from a different origin. The oauth flow needs to be initiated from the same origin",recoverySuggestion:"Please call signInWithRedirect from the same origin."}),On="OAuthSignOutException",Yt="TokenRefreshException",Nn="UnexpectedSignInInterruptionException";function Vn(e){if(!e||!e.accessToken)throw new d({name:V,message:"User needs to be authenticated to call this API.",recoverySuggestion:"Sign in before calling this API again."})}function Ln(e){if(!e||!e.idToken)throw new d({name:V,message:"User needs to be authenticated to call this API.",recoverySuggestion:"Sign in before calling this API again."})}const Qt=new d({name:Yt,message:`Token refresh is not supported when authenticated with the 'implicit grant' (token) oauth flow. 
	Please change your oauth configuration to use 'code grant' flow.`,recoverySuggestion:`Please logout and change your Amplify configuration to use "code grant" flow. 
	E.g { responseType: 'code' }`}),Zt=new d({name:V,message:"User needs to be authenticated to call this API.",recoverySuggestion:"Sign in before calling this API again."});function en(e){if(on(e))throw Qt;if(!nn(e))throw Zt}const tn={inflightOAuth:"inflightOAuth",oauthSignIn:"oauthSignIn",oauthPKCE:"oauthPKCE",oauthState:"oauthState"};function Ce(e){return e?.accessToken||e?.idToken}function nn(e){return Ce(e)&&e?.refreshToken}function on(e){return Ce(e)&&!e?.refreshToken}const rn=e=>(t,n)=>{const o=sn(e),r=JSON.stringify(t);return an(n,o,r)},sn=e=>({"content-type":"application/x-amz-json-1.1","x-amz-target":`AWSCognitoIdentityProviderService.${e}`}),an=({url:e},t,n)=>({headers:t,url:e,body:n,method:"POST"});function Ue(e){if(!e||e.name==="Error"||e instanceof TypeError)throw new d({name:E.Unknown,message:"An unknown error has occurred.",underlyingError:e})}const cn=()=>async e=>{if(e.statusCode>=300){const t=await ye(e);throw Ue(t),new d({name:t.name,message:t.message,metadata:t.$metadata})}return pe(e)},un=()=>(e,t)=>async function(o){return o.headers["cache-control"]="no-store",e(o)},dn=we(Nt,[un]),xe="cognito-idp",ln={service:xe,retryDecider:vt(ye),computeDelay:It,get userAgentValue(){return gt()},cache:"no-store"},hn=({region:e})=>({url:new Ee(`https://${xe}.${e}.${Lt(e)}`)}),gn=({endpointOverride:e})=>t=>e?{url:new Ee(e)}:hn(t),fn=e=>yt(dn,rn("GetTokensFromRefreshToken"),cn(),{...ln,...e}),mn=async({tokens:e,authConfig:t,username:n,clientMetadata:o})=>{f(t?.Cognito);const{userPoolId:r,userPoolClientId:s,userPoolEndpoint:a}=t.Cognito,i=Ht(r);en(e);const h=fn({endpointResolver:gn({endpointOverride:a})}),{AuthenticationResult:c}=await h({region:i},{ClientId:s,RefreshToken:e.refreshToken,DeviceKey:e.deviceMetadata?.deviceKey,ClientMetadata:o}),g=R(c?.AccessToken??""),m=c?.IdToken?R(c.IdToken):void 0,{iat:I}=g.payload;if(!I)throw new d({name:"iatNotFoundException",message:"iat not found in access token"});const x=I*1e3-new Date().getTime();return{accessToken:g,idToken:m,clockDrift:x,refreshToken:c?.RefreshToken??e.refreshToken,username:n}},yn=Gt(mn),pn={accessToken:"accessToken",idToken:"idToken",oidcProvider:"oidcProvider",clockDrift:"clockDrift",refreshToken:"refreshToken",deviceKey:"deviceKey",randomPasswordKey:"randomPasswordKey",deviceGroupKey:"deviceGroupKey",signInDetails:"signInDetails",oauthMetadata:"oauthMetadata"};var C;(function(e){e.InvalidAuthTokens="InvalidAuthTokens"})(C||(C={}));const Sn={[C.InvalidAuthTokens]:{message:"Invalid tokens.",recoverySuggestion:"Make sure the tokens are valid."}},wn=he(Sn),ue="CognitoIdentityServiceProvider";class In{getKeyValueStorage(){if(!this.keyValueStorage)throw new d({name:"KeyValueStorageNotFoundException",message:"KeyValueStorage was not found in TokenStore"});return this.keyValueStorage}setKeyValueStorage(t){this.keyValueStorage=t}setAuthConfig(t){this.authConfig=t}async loadTokens(){try{const t=await this.getAuthKeys(),n=await this.getKeyValueStorage().getItem(t.accessToken);if(!n)throw new d({name:"NoSessionFoundException",message:"Auth session was not found. Make sure to call signIn."});const o=R(n),r=await this.getKeyValueStorage().getItem(t.idToken),s=r?R(r):void 0,a=await this.getKeyValueStorage().getItem(t.refreshToken)??void 0,i=await this.getKeyValueStorage().getItem(t.clockDrift)??"0",h=Number.parseInt(i),c=await this.getKeyValueStorage().getItem(t.signInDetails),g={accessToken:o,idToken:s,refreshToken:a,deviceMetadata:await this.getDeviceMetadata()??void 0,clockDrift:h,username:await this.getLastAuthUser()};return c&&(g.signInDetails=JSON.parse(c)),g}catch{return null}}async storeTokens(t){wn(t!==void 0,C.InvalidAuthTokens);const n=t.username;await this.getKeyValueStorage().setItem(this.getLastAuthUserKey(),n);const o=await this.getAuthKeys();await this.getKeyValueStorage().setItem(o.accessToken,t.accessToken.toString()),t.idToken?await this.getKeyValueStorage().setItem(o.idToken,t.idToken.toString()):await this.getKeyValueStorage().removeItem(o.idToken),t.refreshToken?await this.getKeyValueStorage().setItem(o.refreshToken,t.refreshToken):await this.getKeyValueStorage().removeItem(o.refreshToken),t.deviceMetadata&&(t.deviceMetadata.deviceKey&&await this.getKeyValueStorage().setItem(o.deviceKey,t.deviceMetadata.deviceKey),t.deviceMetadata.deviceGroupKey&&await this.getKeyValueStorage().setItem(o.deviceGroupKey,t.deviceMetadata.deviceGroupKey),await this.getKeyValueStorage().setItem(o.randomPasswordKey,t.deviceMetadata.randomPassword)),t.signInDetails?await this.getKeyValueStorage().setItem(o.signInDetails,JSON.stringify(t.signInDetails)):await this.getKeyValueStorage().removeItem(o.signInDetails),await this.getKeyValueStorage().setItem(o.clockDrift,`${t.clockDrift}`)}async clearTokens(){const t=await this.getAuthKeys();await Promise.all([this.getKeyValueStorage().removeItem(t.accessToken),this.getKeyValueStorage().removeItem(t.idToken),this.getKeyValueStorage().removeItem(t.clockDrift),this.getKeyValueStorage().removeItem(t.refreshToken),this.getKeyValueStorage().removeItem(t.signInDetails),this.getKeyValueStorage().removeItem(this.getLastAuthUserKey()),this.getKeyValueStorage().removeItem(t.oauthMetadata)])}async getDeviceMetadata(t){const n=await this.getAuthKeys(t),o=await this.getKeyValueStorage().getItem(n.deviceKey),r=await this.getKeyValueStorage().getItem(n.deviceGroupKey),s=await this.getKeyValueStorage().getItem(n.randomPasswordKey);return s&&r&&o?{deviceKey:o,deviceGroupKey:r,randomPassword:s}:null}async clearDeviceMetadata(t){const n=await this.getAuthKeys(t);await Promise.all([this.getKeyValueStorage().removeItem(n.deviceKey),this.getKeyValueStorage().removeItem(n.deviceGroupKey),this.getKeyValueStorage().removeItem(n.randomPasswordKey)])}async getAuthKeys(t){f(this.authConfig?.Cognito);const n=t??await this.getLastAuthUser();return En(ue,`${this.authConfig.Cognito.userPoolClientId}.${n}`)}getLastAuthUserKey(){f(this.authConfig?.Cognito);const t=this.authConfig.Cognito.userPoolClientId;return`${ue}.${t}.LastAuthUser`}async getLastAuthUser(){return await this.getKeyValueStorage().getItem(this.getLastAuthUserKey())??"username"}async setOAuthMetadata(t){const{oauthMetadata:n}=await this.getAuthKeys();await this.getKeyValueStorage().setItem(n,JSON.stringify(t))}async getOAuthMetadata(){const{oauthMetadata:t}=await this.getAuthKeys(),n=await this.getKeyValueStorage().getItem(t);return n&&JSON.parse(n)}}const En=(e,t)=>be(pn)(`${e}`,t);function be(e){const t=Object.values({...e});return(n,o)=>t.reduce((r,s)=>({...r,[s]:`${n}.${o}.${s}`}),{})}const de="amplify-signin-with-hostedUI",y="CognitoIdentityServiceProvider";class Tn{constructor(t){this.keyValueStorage=t}async clearOAuthInflightData(){f(this.cognitoConfig);const t=p(y,this.cognitoConfig.userPoolClientId);await Promise.all([this.keyValueStorage.removeItem(t.inflightOAuth),this.keyValueStorage.removeItem(t.oauthPKCE),this.keyValueStorage.removeItem(t.oauthState)])}async clearOAuthData(){f(this.cognitoConfig);const t=p(y,this.cognitoConfig.userPoolClientId);return await this.clearOAuthInflightData(),await this.keyValueStorage.removeItem(de),this.keyValueStorage.removeItem(t.oauthSignIn)}loadOAuthState(){f(this.cognitoConfig);const t=p(y,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.getItem(t.oauthState)}storeOAuthState(t){f(this.cognitoConfig);const n=p(y,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.setItem(n.oauthState,t)}loadPKCE(){f(this.cognitoConfig);const t=p(y,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.getItem(t.oauthPKCE)}storePKCE(t){f(this.cognitoConfig);const n=p(y,this.cognitoConfig.userPoolClientId);return this.keyValueStorage.setItem(n.oauthPKCE,t)}setAuthConfig(t){this.cognitoConfig=t}async loadOAuthInFlight(){f(this.cognitoConfig);const t=p(y,this.cognitoConfig.userPoolClientId);return await this.keyValueStorage.getItem(t.inflightOAuth)==="true"}async storeOAuthInFlight(t){f(this.cognitoConfig);const n=p(y,this.cognitoConfig.userPoolClientId);await this.keyValueStorage.setItem(n.inflightOAuth,`${t}`)}async loadOAuthSignIn(){f(this.cognitoConfig);const t=p(y,this.cognitoConfig.userPoolClientId),n=await this.keyValueStorage.getItem(de),[o,r]=(await this.keyValueStorage.getItem(t.oauthSignIn))?.split(",")??[];return{isOAuthSignIn:o==="true"||n==="true",preferPrivateSession:r==="true"}}async storeOAuthSignIn(t,n=!1){f(this.cognitoConfig);const o=p(y,this.cognitoConfig.userPoolClientId);await this.keyValueStorage.setItem(o.oauthSignIn,`${t},${n}`)}}const p=(e,t)=>be(tn)(e,t),le=new Tn(Re),K=[],vn=e=>{K.push(e)},$n=()=>{for(;K.length;)K.pop()?.()};class kn{constructor(){this.waitForInflightOAuth=ft()?async()=>{if(await le.loadOAuthInFlight())return this.inflightPromise?this.inflightPromise:(this.inflightPromise=new Promise((t,n)=>{vn(t)}),this.inflightPromise)}:async()=>{}}setAuthConfig(t){le.setAuthConfig(t.Cognito),this.authConfig=t}setTokenRefresher(t){this.tokenRefresher=t}setAuthTokenStore(t){this.tokenStore=t}getTokenStore(){if(!this.tokenStore)throw new d({name:"EmptyTokenStoreException",message:"TokenStore not set"});return this.tokenStore}getTokenRefresher(){if(!this.tokenRefresher)throw new d({name:"EmptyTokenRefresherException",message:"TokenRefresher not set"});return this.tokenRefresher}setClientMetadataProvider(t){this.clientMetadataProvider=t}async getTokens(t){let n;try{f(this.authConfig?.Cognito)}catch{return null}await this.waitForInflightOAuth(),this.inflightPromise=void 0,n=await this.getTokenStore().loadTokens();const o=await this.getTokenStore().getLastAuthUser();if(n===null)return null;const r=!!n?.idToken&&ce({expiresAt:(n.idToken?.payload?.exp??0)*1e3,clockDrift:n.clockDrift??0}),s=ce({expiresAt:(n.accessToken?.payload?.exp??0)*1e3,clockDrift:n.clockDrift??0});return(t?.forceRefresh||r||s)&&(n=await this.refreshTokens({tokens:n,username:o,clientMetadata:t?.clientMetadata??await this.clientMetadataProvider?.()}),n===null)?null:{accessToken:n?.accessToken,idToken:n?.idToken,signInDetails:n?.signInDetails}}async refreshTokens({tokens:t,username:n,clientMetadata:o}){try{const{signInDetails:r}=t,s=await this.getTokenRefresher()({tokens:t,authConfig:this.authConfig,username:n,clientMetadata:o});return s.signInDetails=r,await this.setTokens({tokens:s}),L.dispatch("auth",{event:"tokenRefresh"},"Auth",$),s}catch(r){return this.handleErrors(r)}}handleErrors(t){if(Ue(t),this.isAuthenticationError(t)&&this.clearTokens(),L.dispatch("auth",{event:"tokenRefresh_failure",data:{error:t}},"Auth",$),t.name.startsWith("NotAuthorizedException"))return null;throw t}isAuthenticationError(t){return["NotAuthorizedException","TokenRevokedException","UserNotFoundException","PasswordResetRequiredException","UserNotConfirmedException","RefreshTokenReuseException"].some(o=>t?.name?.startsWith?.(o))}async setTokens({tokens:t}){return this.getTokenStore().storeTokens(t)}async clearTokens(){return this.getTokenStore().clearTokens()}getDeviceMetadata(t){return this.getTokenStore().getDeviceMetadata(t)}clearDeviceMetadata(t){return this.getTokenStore().clearDeviceMetadata(t)}setOAuthMetadata(t){return this.getTokenStore().setOAuthMetadata(t)}getOAuthMetadata(){return this.getTokenStore().getOAuthMetadata()}}class Pn{constructor(){this.authTokenStore=new In,this.authTokenStore.setKeyValueStorage(Re),this.tokenOrchestrator=new kn,this.tokenOrchestrator.setAuthTokenStore(this.authTokenStore),this.tokenOrchestrator.setTokenRefresher(yn)}getTokens(t={}){return this.tokenOrchestrator.getTokens(t)}setKeyValueStorage(t){this.authTokenStore.setKeyValueStorage(t)}setClientMetadataProvider(t){this.tokenOrchestrator.setClientMetadataProvider(t)}setAuthConfig(t){this.authTokenStore.setAuthConfig(t),this.tokenOrchestrator.setAuthConfig(t)}}const Rn=new Pn,{tokenOrchestrator:Wn}=Rn;export{Ee as A,le as B,F as C,$n as D,Kn as E,_n as F,bn as G,H,ft as I,ln as J,cn as K,rn as L,dn as M,Tn as N,On as O,en as P,gn as Q,Ht as R,V as U,yt as a,gt as b,we as c,pe as d,me as e,Lt as f,vt as g,An as h,be as i,It as j,R as k,d as l,Mn as m,Ue as n,Ln as o,ye as p,Re as q,Rn as r,Un as s,xn as t,Nt as u,f as v,Vn as w,Wn as x,Nn as y,Dn as z};
