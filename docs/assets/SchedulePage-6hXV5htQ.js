import{c as Qe,n as A,h as T,R as ht,C as Ge,T as bt,U as wt,V as kt,W as Dt,X as xt,Y as Xe,v as St,Z as qt,r as h,_ as Tt,$ as Bt,G as De,a0 as Ct,i as ce,a1 as xe,a2 as Ze,A as It,a3 as ee,a4 as Vt,a5 as Ft,a6 as $t,a7 as Lt,a8 as Mt,o as At,a as j,b as u,w as d,d as l,e as i,j as p,k as Re,f as V,l as _,Q as be,g as ve,t as v,a9 as z,m as X,aa as K,ab as Z,ac as we,ad as Nt,ae as Pt,af as Fe,ag as Qt,ah as Ut}from"./index-C0jMA0yL.js";import{Q as Pe,a as le,b as W,c as N,v as Et,d as Ht,e as $e,f as Le,g as Ot,h as je}from"./v4-Bon5RuRb.js";import{Q as Rt}from"./QSpace-CQB0VToR.js";import{Q as jt}from"./QPage-DsOWwstz.js";import{u as zt}from"./use-quasar-tBGlU9ub.js";const Kt=["top","middle","bottom"],ze=Qe({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:a=>Kt.includes(a)}},setup(a,{slots:o}){const b=A(()=>a.align!==void 0?{verticalAlign:a.align}:null),y=A(()=>{const D=a.outline===!0&&a.color||a.textColor;return`q-badge flex inline items-center no-wrap q-badge--${a.multiLine===!0?"multi":"single"}-line`+(a.outline===!0?" q-badge--outline":a.color!==void 0?` bg-${a.color}`:"")+(D!==void 0?` text-${D}`:"")+(a.floating===!0?" q-badge--floating":"")+(a.rounded===!0?" q-badge--rounded":"")+(a.transparent===!0?" q-badge--transparent":"")});return()=>T("div",{class:y.value,style:b.value,role:"status","aria-label":a.label},ht(o.default,a.label!==void 0?[a.label]:[]))}}),Wt=Qe({name:"QSlideTransition",props:{appear:Boolean,duration:{type:Number,default:300}},emits:["show","hide"],setup(a,{slots:o,emit:b}){let y=!1,D,w,S=null,q=null,B,Q;function U(){D?.(),D=null,y=!1,S!==null&&(clearTimeout(S),S=null),q!==null&&(clearTimeout(q),q=null),w?.removeEventListener("transitionend",B),B=null}function F(g,C,$){C!==void 0&&(g.style.height=`${C}px`),g.style.transition=`height ${a.duration}ms cubic-bezier(.25, .8, .50, 1)`,y=!0,D=$}function O(g,C){g.style.overflowY=null,g.style.height=null,g.style.transition=null,U(),C!==Q&&b(C)}function oe(g,C){let $=0;w=g,y===!0?(U(),$=g.offsetHeight===g.scrollHeight?0:void 0):(Q="hide",g.style.overflowY="hidden"),F(g,$,C),S=setTimeout(()=>{S=null,g.style.height=`${g.scrollHeight}px`,B=M=>{q=null,(Object(M)!==M||M.target===g)&&O(g,"show")},g.addEventListener("transitionend",B),q=setTimeout(B,a.duration*1.1)},100)}function ie(g,C){let $;w=g,y===!0?U():(Q="show",g.style.overflowY="hidden",$=g.scrollHeight),F(g,$,C),S=setTimeout(()=>{S=null,g.style.height=0,B=M=>{q=null,(Object(M)!==M||M.target===g)&&O(g,"hide")},g.addEventListener("transitionend",B),q=setTimeout(B,a.duration*1.1)},100)}return Ge(()=>{y===!0&&U()}),()=>T(bt,{css:!1,appear:a.appear,onEnter:oe,onLeave:ie},o.default)}}),ne=wt({}),Yt=Object.keys(Xe),Ke=Qe({name:"QExpansionItem",props:{...Xe,...xt,...Dt,icon:String,label:String,labelLines:[Number,String],caption:String,captionLines:[Number,String],dense:Boolean,toggleAriaLabel:String,expandIcon:String,expandedIcon:String,expandIconClass:[Array,String,Object],duration:{},headerInsetLevel:Number,contentInsetLevel:Number,expandSeparator:Boolean,defaultOpened:Boolean,hideExpandIcon:Boolean,expandIconToggle:Boolean,switchToggleSide:Boolean,denseToggle:Boolean,group:String,popup:Boolean,headerStyle:[Array,String,Object],headerClass:[Array,String,Object]},emits:[...kt,"click","afterShow","afterHide"],setup(a,{slots:o,emit:b}){const{proxy:{$q:y}}=St(),D=qt(a,y),w=h(a.modelValue!==null?a.modelValue:a.defaultOpened),S=h(null),q=Tt(),{show:B,hide:Q,toggle:U}=Bt({showing:w});let F,O;const oe=A(()=>`q-expansion-item q-item-type q-expansion-item--${w.value===!0?"expanded":"collapsed"} q-expansion-item--${a.popup===!0?"popup":"standard"}`),ie=A(()=>a.contentInsetLevel===void 0?null:{["padding"+(y.lang.rtl===!0?"Right":"Left")]:a.contentInsetLevel*56+"px"}),g=A(()=>a.disable!==!0&&(a.href!==void 0||a.to!==void 0&&a.to!==null&&a.to!=="")),C=A(()=>{const c={};return Yt.forEach(x=>{c[x]=a[x]}),c}),$=A(()=>g.value===!0||a.expandIconToggle!==!0),M=A(()=>a.expandedIcon!==void 0&&w.value===!0?a.expandedIcon:a.expandIcon||y.iconSet.expansionItem[a.denseToggle===!0?"denseIcon":"icon"]),me=A(()=>a.disable!==!0&&(g.value===!0||a.expandIconToggle===!0)),R=A(()=>({expanded:w.value===!0,detailsId:q.value,toggle:U,show:B,hide:Q})),te=A(()=>{const c=a.toggleAriaLabel!==void 0?a.toggleAriaLabel:y.lang.label[w.value===!0?"collapse":"expand"](a.label);return{role:"button","aria-expanded":w.value===!0?"true":"false","aria-controls":q.value,"aria-label":c}});De(()=>a.group,c=>{O?.(),c!==void 0&&L()});function P(c){g.value!==!0&&U(c),b("click",c)}function ae(c){c.keyCode===13&&Y(c,!0)}function Y(c,x){x!==!0&&c.qAvoidFocus!==!0&&S.value?.focus(),U(c),Vt(c)}function re(){b("afterShow")}function ge(){b("afterHide")}function L(){F===void 0&&(F=Ct()),w.value===!0&&(ne[a.group]=F);const c=De(w,de=>{de===!0?ne[a.group]=F:ne[a.group]===F&&delete ne[a.group]}),x=De(()=>ne[a.group],(de,_e)=>{_e===F&&de!==void 0&&de!==F&&Q()});O=()=>{c(),x(),ne[a.group]===F&&delete ne[a.group],O=void 0}}function Se(){const c={class:[`q-focusable relative-position cursor-pointer${a.denseToggle===!0&&a.switchToggleSide===!0?" items-end":""}`,a.expandIconClass],side:a.switchToggleSide!==!0,avatar:a.switchToggleSide},x=[T(ee,{class:"q-expansion-item__toggle-icon"+(a.expandedIcon===void 0&&w.value===!0?" q-expansion-item__toggle-icon--rotated":""),name:M.value})];return me.value===!0&&(Object.assign(c,{tabindex:0,...te.value,onClick:Y,onKeyup:ae}),x.unshift(T("div",{ref:S,class:"q-expansion-item__toggle-focus q-icon q-focus-helper q-focus-helper--rounded",tabindex:-1}))),T(W,c,()=>x)}function qe(){let c;return o.header!==void 0?c=[].concat(o.header(R.value)):(c=[T(W,()=>[T(le,{lines:a.labelLines},()=>a.label||""),a.caption?T(le,{lines:a.captionLines,caption:!0},()=>a.caption):null])],a.icon&&c[a.switchToggleSide===!0?"push":"unshift"](T(W,{side:a.switchToggleSide===!0,avatar:a.switchToggleSide!==!0},()=>T(ee,{name:a.icon})))),a.disable!==!0&&a.hideExpandIcon!==!0&&c[a.switchToggleSide===!0?"unshift":"push"](Se()),c}function pe(){const c={ref:"item",style:a.headerStyle,class:a.headerClass,dark:D.value,disable:a.disable,dense:a.dense,insetLevel:a.headerInsetLevel};return $.value===!0&&(c.clickable=!0,c.onClick=P,Object.assign(c,g.value===!0?C.value:te.value)),T(Pe,c,qe)}function Te(){return xe(T("div",{key:"e-content",class:"q-expansion-item__content relative-position",style:ie.value,id:q.value},It(o.default)),[[Ze,w.value]])}function Be(){const c=[pe(),T(Wt,{duration:a.duration,onShow:re,onHide:ge},Te)];return a.expandSeparator===!0&&c.push(T(ce,{class:"q-expansion-item__border q-expansion-item__border--top absolute-top",dark:D.value}),T(ce,{class:"q-expansion-item__border q-expansion-item__border--bottom absolute-bottom",dark:D.value})),c}return a.group!==void 0&&L(),Ge(()=>{O?.()}),()=>T("div",{class:oe.value},[T("div",{class:"q-expansion-item__container relative-position"},Be())])}});function We(a){if(a===!1)return 0;if(a===!0||a===void 0)return 1;const o=parseInt(a,10);return isNaN(o)?0:o}const Ye=Ft({name:"close-popup",beforeMount(a,{value:o}){const b={depth:We(o),handler(y){b.depth!==0&&setTimeout(()=>{const D=Lt(a);D!==void 0&&Mt(D,y,b.depth)})},handlerKey(y){$t(y,13)===!0&&b.handler(y)}};a.__qclosepopup=b,a.addEventListener("click",b.handler),a.addEventListener("keyup",b.handlerKey)},updated(a,{value:o,oldValue:b}){o!==b&&(a.__qclosepopup.depth=We(o))},beforeUnmount(a){const o=a.__qclosepopup;a.removeEventListener("click",o.handler),a.removeEventListener("keyup",o.handlerKey),delete a.__qclosepopup}}),ye="/api/beers",J={async getAll(){return(await N.get(ye)).data.beers||[]},async getById(a){return(await N.get(`${ye}/${a}`)).data.beer},async create(a){const o={beer_template_id:a.beer_template_id,name:a.name,batch_id:a.batch_id,volume_hl:a.volume_hl,priority:a.priority,min_fermentation_days:a.min_fermentation_days,min_maturation_days:a.min_maturation_days,target_start_date:a.target_start_date,target_completion_date:a.target_completion_date};await N.post(ye,o)},async update(a,o){const b={beer_id:o.beer_id,beer_template_id:o.beer_template_id||null,name:o.name,batch_id:o.batch_id||null,volume_hl:o.volume_hl,priority:o.priority,min_fermentation_days:o.min_fermentation_days,min_maturation_days:o.min_maturation_days||0,target_start_date:o.target_start_date||null,target_completion_date:o.target_completion_date||null,requires_canning:o.requires_canning||!1,tasks:o.tasks||[]};await N.put(`${ye}/${a}`,b)},async delete(a){await N.delete(`${ye}/${a}`)}},Me="/api/canning-days",Ae={async getAll(){return(await N.get(Me)).data.canning_days||[]},async create(a){await N.post(Me,{canning_day:a})},async delete(a){await N.delete(`${Me}/${a}`)}},ke="/api/tasks",Ne={async getById(a){return(await N.get(`${ke}/${a}`)).data.task},async create(a){const o=Et();return(await N.post(ke,{task_id:o,...a,locked:!0})).data},async delete(a){await N.delete(`${ke}/${a}`)},async adjustDuration(a,o){return(await N.put(`${ke}/${a}/duration/${o}`)).data.tasks||[]}},Gt=(a,o)=>{const b=a.__vccOpts||a;for(const[y,D]of o)b[y]=D;return b},Xt={class:"row no-wrap",style:{height:"100%"}},Zt={class:"col-3 q-pa-md",style:{"border-right":"1px solid #e0e0e0","overflow-y":"auto"}},Jt={key:0,class:"flex flex-center q-pa-md"},ea={key:1},ta={class:"text-subtitle2 text-primary"},aa={class:"text-caption"},sa={class:"row q-gutter-sm q-mb-md"},na={key:1,class:"canning-days-list q-mb-md"},la={key:2,class:"text-grey-6 text-center q-pa-sm"},oa={class:"row items-center justify-between q-mb-md"},ia={key:3,class:"flex flex-center q-pa-md"},ra={class:"row items-center justify-between q-mb-sm"},da={class:"beer-details"},ua={class:"detail-row"},ca={class:"detail-row"},ma={class:"detail-row"},ga={class:"detail-row"},va={class:"detail-row"},ya={class:"detail-row"},pa={class:"detail-row"},_a={key:0,class:"q-mt-md"},fa={class:"row items-center justify-between q-mb-sm"},ha={class:"task-type-label"},ba={key:5,class:"text-center text-grey-7 q-pa-md"},wa={class:"col-9 q-pa-md"},ka={class:"row items-center justify-between q-mb-md"},Da={class:"row items-center q-gutter-sm"},xa={class:"text-h6"},Sa={class:"schedule-table-container"},qa={class:"schedule-table"},Ta={class:"date-label"},Ba=["onClick"],Ca={key:0,class:"task-info"},Ia={class:"task-name"},Va={key:0,class:"batch-id"},Fa={class:"task-type"},$a=["onClick"],La={key:0,class:"task-info"},Ma={class:"task-name"},Aa={key:0,class:"batch-id"},Na={class:"task-type"},Pa={class:"text-h6 text-negative"},Qa={class:"text-subtitle1 q-mb-md"},Ua={key:0,class:"q-mb-md"},Ea={class:"text-weight-medium q-mb-sm"},Ha={key:1,class:"q-mb-md"},Oa={class:"text-weight-medium q-mb-sm"},Ra={class:"text-body2 q-ml-md"},ja={key:2},za={class:"text-weight-medium q-mb-sm"},Ka={key:0,class:"q-mb-sm"},Wa={class:"beer-diagnostic-details"},Ya={class:"row q-col-gutter-sm"},Ga={class:"col-6"},Xa={class:"col-6"},Za={class:"col-6"},Ja={class:"col-6"},es={class:"col-6"},ts={key:0,class:"col-6"},as={key:1,class:"col-6"},ss={class:"q-mt-md text-caption text-grey-7"},ns={__name:"SchedulePage",setup(a){const o=zt(),b=h([]),y=h(null),D=h(""),w=h(null),S=h(null),q=h(2),B=h(null),Q=h(null),U=h(null),F=h(null),O=h(null),oe=h(null),ie=h(null),g=h(null),C=h(!1),$=h(!1),M=h(!1),me=h(!1),R=h(new Date),te=h([]),P=h([]),ae=h([]),Y=h(null),re=h(!1),ge=h(!1),L=h(null),Se=["F6","F5","F4","F3","F2","F1","B1","B2"];De(y,s=>{s?(w.value=s.min_fermentation_days,S.value=s.min_maturation_days):(w.value=null,S.value=null)});const qe=A(()=>{const s=new Date(R.value),t=new Date(R.value);return t.setDate(t.getDate()+29),`${s.toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`}),pe=A(()=>{const s=[],t=new Date;t.setHours(0,0,0,0);for(let e=0;e<30;e++){const n=new Date(R.value);n.setDate(n.getDate()+e),n.setHours(0,0,0,0);const r=Te(n),m=n.getTime()===t.getTime(),I=n.getDay()===0||n.getDay()===6,ue=Be(n);s.push({date:r,label:n.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),isToday:m,isWeekend:I,isHoliday:ue,fullDate:new Date(n)})}return s}),Te=s=>{const t=s.getFullYear(),e=String(s.getMonth()+1).padStart(2,"0"),n=String(s.getDate()).padStart(2,"0");return`${t}-${e}-${n}`},Be=s=>{const t=s.getFullYear(),e=s.getMonth()+1,n=s.getDate();if(e===1&&n===1||e===1&&n===26||e===4&&n===25||e===12&&n===25||e===12&&n===26)return!0;if(e===5){const r=new Date(t,4,1);for(;r.getDay()!==1;)r.setDate(r.getDate()+1);if(n===r.getDate())return!0}if(e===6){const r=new Date(t,5,1);for(;r.getDay()!==1;)r.setDate(r.getDate()+1);const m=new Date(r);if(m.setDate(m.getDate()+7),n===m.getDate())return!0}if(e===8){const r=new Date(t,7,1);for(;r.getDay()!==3;)r.setDate(r.getDate()+1);const m=new Date(r);if(m.setDate(m.getDate()+14),n===m.getDate())return!0}return!1},c=async()=>{C.value=!0;try{b.value=await Ht.getAll()}catch(s){o.notify({type:"negative",message:"Failed to load beer templates",caption:s.response?.data?.message||s.message})}finally{C.value=!1}},x=async()=>{M.value=!0;try{const s=await J.getAll();te.value=s;const t=[];for(const e of s)e.tasks&&Array.isArray(e.tasks)&&t.push(...e.tasks);P.value=t}catch(s){o.notify({type:"negative",message:"Failed to load beers",caption:s.response?.data?.message||s.message})}finally{M.value=!1}},de=async()=>{if(!(!y.value||!D.value||w.value===null||S.value===null||q.value===null)){$.value=!0;try{const s={beer_template_id:y.value.beer_template_id,name:y.value.beer_name,batch_id:D.value,volume_hl:y.value.volume_hl,priority:q.value,min_fermentation_days:w.value,min_maturation_days:S.value,target_start_date:B.value||null,target_completion_date:Q.value||null};await J.create(s),o.notify({type:"positive",message:"Beer created successfully",caption:`${s.name} ${s.batch_id}`,icon:"local_drink"}),y.value=null,D.value="",w.value=null,S.value=null,q.value=2,B.value=null,Q.value=null,U.value?.resetValidation(),F.value?.resetValidation(),O.value?.resetValidation(),oe.value?.resetValidation(),ie.value?.resetValidation(),g.value?.resetValidation(),await x(),await E()}catch(s){o.notify({type:"negative",message:"Failed to create beer",caption:s.response?.data?.message||s.message})}finally{$.value=!1}}},_e=[[229,57,53],[30,136,229],[67,160,71],[251,140,0],[142,36,170],[0,172,193],[255,179,0],[109,76,65],[216,27,96],[57,73,171],[0,137,123],[124,179,66],[244,81,30],[94,53,177],[3,155,229],[192,202,51]],fe=new Map,Ce=(s,t=!1)=>{if(!fe.has(s)){const ue=fe.size%_e.length;fe.set(s,ue)}const e=fe.get(s),[n,r,m]=_e[e];return`rgba(${n}, ${r}, ${m}, ${t?.4:.2})`},E=async()=>{me.value=!0;try{const s=new Date;s.setDate(s.getDate()+1),s.setHours(0,0,0,0);const t=f=>{const G=new Date(f);G.setHours(0,0,0,0);const H=G.getTime()-s.getTime();return Math.floor(H/(1e3*60*60*24))},e=f=>f?t(f):null,n=[],r=[],m=[];for(const f of te.value){const G=(f.tasks||[]).filter(H=>H.locked);if(G.length>0){n.push(f);for(const H of G)m.push({resource:H.resource,start_day:Math.max(0,t(H.start_date)),end_day:Math.max(0,t(H.end_date))})}else r.push({id:f.beer_id,name:f.name,volume_hl:f.volume_hl,priority:f.priority,min_fermentation_days:f.min_fermentation_days,min_maturation_days:f.min_maturation_days||0,requires_canning:f.requires_canning||!1,target_completion_day:e(f.target_completion_date),tasks:[]})}const I={beers:r,canning_days:ae.value};m.length>0&&(I.resource_blocks=m);const Ve=(await N.post("/api/schedule",I)).data.schedule?.beers||[],se=[];for(const f of Ve)if(f.tasks&&Array.isArray(f.tasks))for(const G of f.tasks)se.push({...G,beer_id:f.beer_id,beer_name:f.name,batch_id:f.batch_id});for(const f of n){const G=(f.tasks||[]).filter(H=>H.locked);for(const H of G)se.push({...H,beer_id:f.beer_id,beer_name:f.name,batch_id:f.batch_id})}P.value=se,o.notify({type:"positive",message:"Beers scheduled successfully",icon:"calendar_today"})}catch(s){console.error("Schedule error:",s);const t=s.response?.data;t?.error==="SCHEDULING_ERROR"&&t?.diagnostic?(L.value=t,ge.value=!0):o.notify({type:"negative",message:"Failed to schedule beers",caption:t?.message||s.message})}finally{me.value=!1}},k=(s,t)=>{const e=t.toLowerCase();return P.value.filter(n=>{if(n.resource.toLowerCase()!==e)return!1;const r=new Date(n.start_date),m=new Date(n.end_date),I=new Date(s);return r.setHours(0,0,0,0),m.setHours(0,0,0,0),I.setHours(0,0,0,0),I>=r&&I<=m})},Ue=(s,t)=>{const e=new Date(t.start_date),n=new Date(t.end_date),r=new Date(s);e.setHours(0,0,0,0),n.setHours(0,0,0,0),r.setHours(0,0,0,0);const m=r.getTime()===e.getTime(),I=r.getTime()===n.getTime(),ue=Math.round((n-e)/(1e3*60*60*24))+1,Ve=Math.floor(ue/2),se=new Date(e);se.setDate(se.getDate()+Ve);const f=r.getTime()===se.getTime();return{isFirst:m,isLast:I,isMiddle:f,isSingle:m&&I}},Ee=(s,t)=>{const e=Ue(s,t);return e.isMiddle||e.isSingle},he=s=>P.value.filter(t=>t.beer_id===s),Je=s=>{const t=he(s);return t.length===0?!1:t.every(e=>e.locked)},et=async(s,t)=>{const e=he(s.beer_id);if(e.length!==0)try{if(t){for(const n of e)if(!n.locked){const r=await Ne.create({beer_id:s.beer_id,beer_name:s.name,task_type:n.task_type,start_day:n.start_day,start_date:n.start_date,duration:n.duration,end_day:n.end_day,end_date:n.end_date,resource:n.resource,volume_hl:s.volume_hl}),m=P.value.findIndex(I=>I.beer_id===s.beer_id&&I.task_type===n.task_type);m!==-1&&(P.value[m]={...P.value[m],task_id:r.task_id,locked:!0})}o.notify({type:"positive",message:"All tasks pinned",caption:s.name,icon:"push_pin"})}else{for(const n of e)if(n.locked&&n.task_id){await Ne.delete(n.task_id);const r=P.value.findIndex(m=>m.beer_id===s.beer_id&&m.task_type===n.task_type);r!==-1&&(P.value[r]={...P.value[r],task_id:null,locked:!1})}o.notify({type:"positive",message:"All tasks unpinned",caption:s.name,icon:"push_pin"})}}catch(n){o.notify({type:"negative",message:t?"Failed to pin tasks":"Failed to unpin tasks",caption:n.response?.data?.message||n.message})}},He=(s,t)=>{const e=k(s.date,t),n=e.length>0,r={today:s.isToday,weekend:s.isWeekend,holiday:s.isHoliday,"has-task":n};if(n){const m=Ue(s.date,e[0]);r["task-first"]=m.isFirst&&!m.isSingle,r["task-last"]=m.isLast&&!m.isSingle,r["task-middle"]=!m.isFirst&&!m.isLast,r["task-single"]=m.isSingle}return r},tt=s=>{o.notify({type:"info",message:`Viewing ${s.name}`,caption:"Feature coming soon..."})},Oe=async(s,t)=>{if(t)if(t.locked&&t.task_id&&(s.metaKey||s.ctrlKey)){const e=s.shiftKey?-1:1;try{await Ne.adjustDuration(t.task_id,e),o.notify({type:"positive",message:`Task duration ${e>0?"increased":"decreased"} by 1 day`,icon:"schedule"}),await x(),await E()}catch(n){o.notify({type:"negative",message:"Failed to adjust task duration",caption:n.response?.data?.message||n.message})}}else tt(t)},at=s=>{o.dialog({title:"Confirm Delete",message:`Are you sure you want to delete ${s.name} (${s.batch_id})?`,cancel:!0,persistent:!0}).onOk(async()=>{await st(s.beer_id)})},st=async s=>{try{await J.delete(s),o.notify({type:"positive",message:"Beer deleted successfully",icon:"delete"}),await x(),await E()}catch(t){o.notify({type:"negative",message:"Failed to delete beer",caption:t.response?.data?.message||t.message})}},nt=async(s,t)=>{try{const e=Number(t);if(isNaN(e)||e<=0){o.notify({type:"negative",message:"Invalid volume",caption:"Must be greater than 0"});return}const n={...s,volume_hl:e};await J.update(s.beer_id,n),o.notify({type:"positive",message:"Volume updated successfully",icon:"check"}),await x(),await E()}catch(e){o.notify({type:"negative",message:"Failed to update volume",caption:e.response?.data?.message||e.message})}},lt=async(s,t)=>{try{const e={...s,priority:t};await J.update(s.beer_id,e),o.notify({type:"positive",message:"Priority updated successfully",icon:"check"}),await x(),await E()}catch(e){o.notify({type:"negative",message:"Failed to update priority",caption:e.response?.data?.message||e.message})}},ot=async(s,t)=>{try{const e=Number(t);if(isNaN(e)||e<0){o.notify({type:"negative",message:"Invalid fermentation days",caption:"Must be 0 or greater"});return}const n={...s,min_fermentation_days:e};await J.update(s.beer_id,n),o.notify({type:"positive",message:"Min fermentation days updated successfully",icon:"check"}),await x(),await E()}catch(e){o.notify({type:"negative",message:"Failed to update min fermentation days",caption:e.response?.data?.message||e.message})}},it=async(s,t)=>{try{const e={...s,target_start_date:t||null};await J.update(s.beer_id,e),o.notify({type:"positive",message:"Target start date updated successfully",icon:"check"}),await x(),await E()}catch(e){o.notify({type:"negative",message:"Failed to update target start date",caption:e.response?.data?.message||e.message})}},rt=async(s,t)=>{try{const e={...s,target_completion_date:t||null};await J.update(s.beer_id,e),o.notify({type:"positive",message:"Target completion date updated successfully",icon:"check"}),await x(),await E()}catch(e){o.notify({type:"negative",message:"Failed to update target completion date",caption:e.response?.data?.message||e.message})}},dt=async(s,t)=>{try{const e={...s,requires_canning:t};await J.update(s.beer_id,e),o.notify({type:"positive",message:"Requires canning updated successfully",icon:"check"}),await x(),await E()}catch(e){o.notify({type:"negative",message:"Failed to update requires canning",caption:e.response?.data?.message||e.message})}},ut=()=>{const s=new Date(R.value);s.setDate(s.getDate()-30),R.value=s},ct=()=>{const s=new Date(R.value);s.setDate(s.getDate()+30),R.value=s},mt=()=>{R.value=new Date},gt=s=>{switch(s){case 5:return"red";case 4:return"orange";case 3:return"amber";case 2:return"blue";case 1:return"grey";default:return"grey"}},Ie=async()=>{try{ae.value=await Ae.getAll()}catch(s){console.error("Failed to load canning days:",s)}},vt=s=>ae.value.includes(s),yt=async()=>{if(Y.value){re.value=!0;try{await Ae.create(Y.value),await Ie(),Y.value=null,o.notify({type:"positive",message:"Canning day added",icon:"event"})}catch(s){o.notify({type:"negative",message:"Failed to add canning day",caption:s.response?.data?.message||s.message})}finally{re.value=!1}}},pt=async s=>{try{await Ae.delete(s),await Ie(),o.notify({type:"positive",message:"Canning day removed",icon:"event_busy"})}catch(t){o.notify({type:"negative",message:"Failed to remove canning day",caption:t.response?.data?.message||t.message})}},_t=s=>new Date(s).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),ft=s=>!s||s.length===0?"None":s.map(t=>`Day ${t}`).join(", ");return At(async()=>{await Promise.all([c(),x(),Ie()]),await E()}),(s,t)=>(u(),j(jt,{class:"schedule-page"},{default:d(()=>[l("div",Xt,[l("div",Zt,[t[26]||(t[26]=l("div",{class:"text-h5 q-mb-md"},"Create Beer",-1)),C.value?(u(),p("div",Jt,[i(Re,{color:"primary",size:"md"})])):(u(),p("div",ea,[i($e,{modelValue:y.value,"onUpdate:modelValue":t[0]||(t[0]=e=>y.value=e),options:b.value,"option-label":"beer_name","option-value":"beer_template_id",label:"Select Beer Template",outlined:"",disable:b.value.length===0},{"no-option":d(()=>[i(Pe,null,{default:d(()=>[i(W,{class:"text-grey"},{default:d(()=>[...t[9]||(t[9]=[_(" No templates available ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","options","disable"]),y.value?(u(),j(be,{key:0,flat:"",bordered:"",class:"q-mt-md"},{default:d(()=>[i(ve,null,{default:d(()=>[l("div",ta,v(y.value.beer_name),1),i(ce,{class:"q-my-sm"}),l("div",aa,[l("div",null,[t[10]||(t[10]=l("strong",null,"Volume:",-1)),_(" "+v(y.value.volume_hl)+" hl",1)]),l("div",null,[t[11]||(t[11]=l("strong",null,"Maturation:",-1)),_(" "+v(y.value.min_maturation_days)+" days",1)])]),i(ce,{class:"q-my-sm"}),i(z,{ref_key:"batchIdInput",ref:U,modelValue:D.value,"onUpdate:modelValue":t[1]||(t[1]=e=>D.value=e),label:"Batch ID *",outlined:"",dense:"",class:"q-mt-sm",rules:[e=>!!e||"Batch ID is required"]},null,8,["modelValue","rules"]),i(z,{ref_key:"minFermentationDaysInput",ref:F,modelValue:w.value,"onUpdate:modelValue":t[2]||(t[2]=e=>w.value=e),modelModifiers:{number:!0},label:"Min Fermentation Days *",type:"number",outlined:"",dense:"",class:"q-mt-sm",rules:[e=>e!==null&&e!==""&&e!==void 0||"Min fermentation days is required",e=>e>=0||"Must be 0 or greater"]},null,8,["modelValue","rules"]),i(z,{ref_key:"minMaturationDaysInput",ref:O,modelValue:S.value,"onUpdate:modelValue":t[3]||(t[3]=e=>S.value=e),modelModifiers:{number:!0},label:"Min Maturation Days *",type:"number",outlined:"",dense:"",class:"q-mt-sm",rules:[e=>e!==null&&e!==""&&e!==void 0||"Min maturation days is required",e=>e>=0||"Must be 0 or greater"]},null,8,["modelValue","rules"]),i($e,{ref_key:"priorityInput",ref:oe,modelValue:q.value,"onUpdate:modelValue":t[4]||(t[4]=e=>q.value=e),options:[1,2,3],label:"Priority *",outlined:"",dense:"",class:"q-mt-sm",rules:[e=>e!=null||"Priority is required"]},null,8,["modelValue","rules"]),i(z,{ref_key:"targetStartDateInput",ref:ie,modelValue:B.value,"onUpdate:modelValue":t[5]||(t[5]=e=>B.value=e),label:"Target Start Date",outlined:"",dense:"",type:"date",class:"q-mt-sm"},null,8,["modelValue"]),i(z,{ref_key:"targetDateInput",ref:g,modelValue:Q.value,"onUpdate:modelValue":t[6]||(t[6]=e=>Q.value=e),label:"Target Completion Date",outlined:"",dense:"",type:"date",class:"q-mt-sm"},null,8,["modelValue"]),i(X,{color:"primary",icon:"add",label:"Create Beer",class:"full-width q-mt-md",disable:!D.value||w.value===null||S.value===null||q.value===null||$.value,loading:$.value,onClick:de},null,8,["disable","loading"])]),_:1})]),_:1})):V("",!0),i(ce,{class:"q-my-md"}),t[25]||(t[25]=l("div",{class:"text-h6 q-mb-md"},"Canning Days",-1)),l("div",sa,[i(z,{modelValue:Y.value,"onUpdate:modelValue":t[7]||(t[7]=e=>Y.value=e),type:"date",label:"Add Canning Day",outlined:"",dense:"",class:"col"},null,8,["modelValue"]),i(X,{color:"primary",icon:"add",disable:!Y.value||re.value,loading:re.value,onClick:yt},{default:d(()=>[i(Le,null,{default:d(()=>[...t[12]||(t[12]=[_("Add Canning Day",-1)])]),_:1})]),_:1},8,["disable","loading"])]),ae.value.length>0?(u(),p("div",na,[(u(!0),p(K,null,Z(ae.value,e=>(u(),j(Ot,{key:e,removable:"",color:"red","text-color":"white",onRemove:n=>pt(e)},{default:d(()=>[_(v(_t(e)),1)]),_:2},1032,["onRemove"]))),128))])):(u(),p("div",la," No canning days scheduled ")),i(ce,{class:"q-my-md"}),l("div",oa,[t[14]||(t[14]=l("div",{class:"text-h6"},"Batches",-1)),i(X,{flat:"",dense:"",round:"",icon:"calendar_today",size:"sm",color:"primary",loading:me.value,onClick:E},{default:d(()=>[i(Le,null,{default:d(()=>[...t[13]||(t[13]=[_("Schedule Beers",-1)])]),_:1})]),_:1},8,["loading"])]),M.value?(u(),p("div",ia,[i(Re,{color:"primary",size:"md"})])):te.value.length>0?(u(),j(je,{key:4},{default:d(()=>[(u(!0),p(K,null,Z(te.value,e=>(u(),j(Ke,{key:e.beer_id,"expand-separator":"",class:"color-indicator",style:we({backgroundColor:Ce(e.beer_id)})},{header:d(()=>[i(W,null,{default:d(()=>[i(le,null,{default:d(()=>[_(v(e.name),1)]),_:2},1024),i(le,{caption:""},{default:d(()=>[_(v(e.batch_id),1)]),_:2},1024)]),_:2},1024),i(W,{side:""},{default:d(()=>[i(ze,{color:gt(e.priority)},{default:d(()=>[_(" P"+v(e.priority),1)]),_:2},1032,["color"])]),_:2},1024)]),default:d(()=>[i(be,{flat:""},{default:d(()=>[i(ve,{class:"q-pt-none"},{default:d(()=>[l("div",ra,[t[16]||(t[16]=l("div",{class:"text-subtitle2"},"Beer Details",-1)),i(X,{flat:"",dense:"",round:"",icon:"delete",color:"negative",size:"sm",onClick:n=>at(e)},{default:d(()=>[i(Le,null,{default:d(()=>[...t[15]||(t[15]=[_("Delete Beer",-1)])]),_:1})]),_:1},8,["onClick"])]),l("div",da,[l("div",ua,[t[17]||(t[17]=l("span",{class:"detail-label"},"Batch ID:",-1)),l("span",null,v(e.batch_id),1)]),l("div",ca,[t[18]||(t[18]=l("span",{class:"detail-label"},"Volume:",-1)),i(z,{"model-value":e.volume_hl,type:"number",suffix:"hl",dense:"",outlined:"",style:{"max-width":"100px"},rules:[n=>n>0||"Must be greater than 0"],"onUpdate:modelValue":n=>nt(e,n)},null,8,["model-value","rules","onUpdate:modelValue"])]),l("div",ma,[t[19]||(t[19]=l("span",{class:"detail-label"},"Priority:",-1)),i($e,{"model-value":e.priority,options:[1,2,3],dense:"",outlined:"",style:{"max-width":"80px"},"onUpdate:modelValue":n=>lt(e,n)},null,8,["model-value","onUpdate:modelValue"])]),l("div",ga,[t[20]||(t[20]=l("span",{class:"detail-label"},"Min Fermentation:",-1)),i(z,{"model-value":e.min_fermentation_days,type:"number",suffix:"days",dense:"",outlined:"",style:{"max-width":"120px"},rules:[n=>n>=0||"Must be 0 or greater"],onChange:n=>ot(e,n.target.value)},null,8,["model-value","rules","onChange"])]),l("div",va,[t[21]||(t[21]=l("span",{class:"detail-label"},"Target Start:",-1)),i(z,{"model-value":e.target_start_date||"",type:"date",dense:"",outlined:"",style:{"max-width":"150px"},"onUpdate:modelValue":n=>it(e,n)},null,8,["model-value","onUpdate:modelValue"])]),l("div",ya,[t[22]||(t[22]=l("span",{class:"detail-label"},"Target Completion:",-1)),i(z,{"model-value":e.target_completion_date||"",type:"date",dense:"",outlined:"",style:{"max-width":"150px"},"onUpdate:modelValue":n=>rt(e,n)},null,8,["model-value","onUpdate:modelValue"])]),l("div",pa,[t[23]||(t[23]=l("span",{class:"detail-label"},"Requires Canning:",-1)),i(Nt,{"model-value":e.requires_canning||!1,dense:"","onUpdate:modelValue":n=>dt(e,n)},null,8,["model-value","onUpdate:modelValue"])])]),he(e.beer_id).length>0?(u(),p("div",_a,[l("div",fa,[t[24]||(t[24]=l("div",{class:"text-subtitle2"},"Scheduled Tasks",-1)),i(Pt,{"model-value":Je(e.beer_id),label:"Pin All",dense:"",size:"sm","onUpdate:modelValue":n=>et(e,n)},null,8,["model-value","onUpdate:modelValue"])]),(u(!0),p(K,null,Z(he(e.beer_id),n=>(u(),p("div",{key:`${e.beer_id}-${n.task_type}`,class:"task-row"},[l("span",ha,v(n.task_type),1),n.locked?(u(),j(ee,{key:0,name:"push_pin",size:"xs",color:"primary"})):V("",!0)]))),128))])):V("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["style"]))),128))]),_:1})):(u(),p("div",ba," No beers scheduled yet "))]))]),l("div",wa,[l("div",ka,[t[27]||(t[27]=l("div",{class:"text-h4"},"Schedule",-1)),l("div",Da,[i(X,{flat:"",dense:"",round:"",icon:"chevron_left",onClick:ut}),l("div",xa,v(qe.value),1),i(X,{flat:"",dense:"",round:"",icon:"chevron_right",onClick:ct}),i(X,{flat:"",label:"Today",onClick:mt})])]),l("div",Sa,[l("div",qa,[t[28]||(t[28]=l("div",{class:"schedule-header"},"Date",-1)),t[29]||(t[29]=l("div",{class:"schedule-header"},"Brewhouse",-1)),t[30]||(t[30]=l("div",{class:"schedule-header"},[l("div",null,"F6"),l("div",{class:"volume-label"},"20hl")],-1)),t[31]||(t[31]=l("div",{class:"schedule-header"},[l("div",null,"F5"),l("div",{class:"volume-label"},"20hl")],-1)),t[32]||(t[32]=l("div",{class:"schedule-header"},[l("div",null,"F4"),l("div",{class:"volume-label"},"20hl")],-1)),t[33]||(t[33]=l("div",{class:"schedule-header"},[l("div",null,"F3"),l("div",{class:"volume-label"},"20hl")],-1)),t[34]||(t[34]=l("div",{class:"schedule-header"},[l("div",null,"F2"),l("div",{class:"volume-label"},"10hl")],-1)),t[35]||(t[35]=l("div",{class:"schedule-header"},[l("div",null,"F1"),l("div",{class:"volume-label"},"10hl")],-1)),t[36]||(t[36]=l("div",{class:"schedule-header"},[l("div",null,"B1"),l("div",{class:"volume-label"},"10hl")],-1)),t[37]||(t[37]=l("div",{class:"schedule-header"},[l("div",null,"B2"),l("div",{class:"volume-label"},"20hl")],-1)),(u(!0),p(K,null,Z(pe.value,e=>(u(),p(K,{key:e.date},[l("div",{class:Fe(["schedule-cell date-cell",{today:e.isToday,weekend:e.isWeekend,holiday:e.isHoliday}])},[l("div",Ta,v(e.label),1)],2),l("div",{class:Fe(["schedule-cell tank-cell",He(e,"Brewhouse")]),style:we(k(e.date,"Brewhouse").length>0?{backgroundColor:Ce(k(e.date,"Brewhouse")[0].beer_id,k(e.date,"Brewhouse")[0].locked)}:{}),onClick:n=>k(e.date,"Brewhouse").length>0?Oe(n,k(e.date,"Brewhouse")[0]):null},[k(e.date,"Brewhouse").length>0&&Ee(e.date,k(e.date,"Brewhouse")[0])?(u(),p("div",Ca,[l("div",Ia,[_(v(k(e.date,"Brewhouse")[0].beer_name)+" ",1),k(e.date,"Brewhouse")[0].batch_id?(u(),p("span",Va,v(k(e.date,"Brewhouse")[0].batch_id),1)):V("",!0)]),l("div",Fa,v(k(e.date,"Brewhouse")[0].task_type),1)])):V("",!0)],14,Ba),(u(),p(K,null,Z(Se,n=>l("div",{key:`${e.date}-${n}`,class:Fe(["schedule-cell tank-cell",He(e,n)]),style:we(k(e.date,n).length>0?{backgroundColor:Ce(k(e.date,n)[0].beer_id,k(e.date,n)[0].locked)}:{}),onClick:r=>k(e.date,n).length>0?Oe(r,k(e.date,n)[0]):null},[k(e.date,n).length>0&&Ee(e.date,k(e.date,n)[0])?(u(),p("div",La,[l("div",Ma,[_(v(k(e.date,n)[0].beer_name)+" ",1),k(e.date,n)[0].batch_id?(u(),p("span",Aa,v(k(e.date,n)[0].batch_id),1)):V("",!0)]),l("div",Na,v(k(e.date,n)[0].task_type),1)])):V("",!0)],14,$a)),64))],64))),128))]),(u(!0),p(K,null,Z(pe.value,(e,n)=>xe((u(),p("div",{key:"canning-"+e.date,class:"canning-day-overlay",style:we({top:`calc(${n} * 36px + 57px)`})},null,4)),[[Ze,vt(e.date)]])),128))])])]),i(Qt,{modelValue:ge.value,"onUpdate:modelValue":t[8]||(t[8]=e=>ge.value=e),persistent:""},{default:d(()=>[i(be,{style:{"min-width":"500px","max-width":"700px"}},{default:d(()=>[i(ve,{class:"row items-center q-pb-none"},{default:d(()=>[l("div",Pa,[i(ee,{name:"error",class:"q-mr-sm"}),t[38]||(t[38]=_(" Scheduling Failed ",-1))]),i(Rt),xe(i(X,{icon:"close",flat:"",round:"",dense:""},null,512),[[Ye]])]),_:1}),L.value?(u(),j(ve,{key:0},{default:d(()=>[l("div",Qa,v(L.value.message),1),L.value.diagnostic?.warnings?.length>0?(u(),p("div",Ua,[l("div",Ea,[i(ee,{name:"warning",color:"warning",class:"q-mr-xs"}),t[39]||(t[39]=_(" Warnings ",-1))]),i(je,{dense:"",bordered:"",separator:"",class:"rounded-borders"},{default:d(()=>[(u(!0),p(K,null,Z(L.value.diagnostic.warnings,(e,n)=>(u(),j(Pe,{key:n},{default:d(()=>[i(W,null,{default:d(()=>[i(le,{class:"text-body2"},{default:d(()=>[_(v(e),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):V("",!0),L.value.diagnostic?.canning?(u(),p("div",Ha,[l("div",Oa,[i(ee,{name:"inventory_2",color:"primary",class:"q-mr-xs"}),t[40]||(t[40]=_(" Canning Constraints ",-1))]),l("div",Ra,[l("div",null,[t[41]||(t[41]=l("strong",null,"Available canning days:",-1)),_(" "+v(ft(L.value.diagnostic.canning.available_days)),1)]),l("div",null,[t[42]||(t[42]=l("strong",null,"Beers requiring canning:",-1)),_(" "+v(L.value.diagnostic.canning.beers_requiring_canning),1)])])])):V("",!0),L.value.diagnostic?.beer_diagnostics?.length>0?(u(),p("div",ja,[l("div",za,[i(ee,{name:"sports_bar",color:"amber",class:"q-mr-xs"}),t[43]||(t[43]=_(" Beer Details ",-1))]),(u(!0),p(K,null,Z(L.value.diagnostic.beer_diagnostics,e=>(u(),j(Ke,{key:e.id,dense:"","expand-separator":"","header-class":e.warnings?.length>0?"text-negative":""},{header:d(()=>[i(W,{avatar:""},{default:d(()=>[i(ee,{name:e.warnings?.length>0?"error":"check_circle",color:e.warnings?.length>0?"negative":"positive",size:"sm"},null,8,["name","color"])]),_:2},1024),i(W,null,{default:d(()=>[i(le,null,{default:d(()=>[_(v(e.name),1)]),_:2},1024),i(le,{caption:""},{default:d(()=>[_(v(e.volume_hl)+" hl",1)]),_:2},1024)]),_:2},1024),e.warnings?.length>0?(u(),j(W,{key:0,side:""},{default:d(()=>[i(ze,{color:"negative"},{default:d(()=>[_(v(e.warnings.length)+" warning(s)",1)]),_:2},1024)]),_:2},1024)):V("",!0)]),default:d(()=>[i(be,{flat:""},{default:d(()=>[i(ve,{class:"q-pt-none"},{default:d(()=>[e.warnings?.length>0?(u(),p("div",Ka,[(u(!0),p(K,null,Z(e.warnings,(n,r)=>(u(),p("div",{key:r,class:"text-negative text-body2 q-mb-xs"},[i(ee,{name:"warning",size:"xs",class:"q-mr-xs"}),_(" "+v(n),1)]))),128))])):V("",!0),l("div",Wa,[l("div",Ya,[l("div",Ga,[t[44]||(t[44]=l("span",{class:"text-grey-7"},"Brew days:",-1)),_(" "+v(e.brew_days),1)]),l("div",Xa,[t[45]||(t[45]=l("span",{class:"text-grey-7"},"Min fermentation:",-1)),_(" "+v(e.min_fermentation_days)+" days ",1)]),l("div",Za,[t[46]||(t[46]=l("span",{class:"text-grey-7"},"Min maturation:",-1)),_(" "+v(e.min_maturation_days)+" days ",1)]),l("div",Ja,[t[47]||(t[47]=l("span",{class:"text-grey-7"},"Min to completion:",-1)),_(" "+v(e.min_days_to_completion)+" days ",1)]),l("div",es,[t[48]||(t[48]=l("span",{class:"text-grey-7"},"Requires canning:",-1)),_(" "+v(e.requires_canning?"Yes":"No"),1)]),e.target_completion_day!==null?(u(),p("div",ts,[t[49]||(t[49]=l("span",{class:"text-grey-7"},"Target completion:",-1)),_(" Day "+v(e.target_completion_day),1)])):V("",!0),e.earliest_feasible_canning_day!==null?(u(),p("div",as,[t[50]||(t[50]=l("span",{class:"text-grey-7"},"Earliest canning:",-1)),_(" Day "+v(e.earliest_feasible_canning_day),1)])):V("",!0)])])]),_:2},1024)]),_:2},1024)]),_:2},1032,["header-class"]))),128))])):V("",!0),l("div",ss," Solver status: "+v(L.value.diagnostic?.solver_status),1)]),_:1})):V("",!0),i(Ut,{align:"right"},{default:d(()=>[xe(i(X,{flat:"",label:"Close",color:"primary"},null,512),[[Ye]])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},us=Gt(ns,[["__scopeId","data-v-59907bd0"]]);export{us as default};
