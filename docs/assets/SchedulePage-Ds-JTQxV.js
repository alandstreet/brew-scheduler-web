import{c as rt,C as Vt,h as V,T as ua,U as ca,V as ga,W as ma,X as ya,Y as $t,v as va,Z as _a,r as _,_ as pa,$ as fa,n as Q,G as Re,a0 as ha,i as Se,a1 as je,a2 as ka,A as ba,a3 as J,a4 as wa,R as Da,a5 as xa,a6 as Sa,a7 as Ta,a8 as qa,o as Ca,a as A,b as u,w as c,d as o,e as r,j as y,k as Dt,f as D,l as v,Q as $e,g as ye,t as m,a9 as R,m as E,aa as K,ab as Z,ac as tt,ad as Ee,ae as Ba,af as Ia,ag as xt,ah as St,ai as Tt}from"./index-BkuSAYUw.js";import{Q as it,a as _e,b as ee,c as I,v as Va,d as $a,s as Fa,e as Qe,f as xe,g as qt,h as Ct}from"./subTaskNames-B9sgU7R7.js";import{Q as Na}from"./QSpace-qnUXH8m4.js";import{Q as Ma}from"./QPage-B596LabI.js";import{u as La}from"./use-quasar-DvaPYcZ0.js";const Aa=rt({name:"QSlideTransition",props:{appear:Boolean,duration:{type:Number,default:300}},emits:["show","hide"],setup(n,{slots:l,emit:p}){let k=!1,x,w,T=null,C=null,N,j;function z(){x?.(),x=null,k=!1,T!==null&&(clearTimeout(T),T=null),C!==null&&(clearTimeout(C),C=null),w?.removeEventListener("transitionend",N),N=null}function H(f,M,U){M!==void 0&&(f.style.height=`${M}px`),f.style.transition=`height ${n.duration}ms cubic-bezier(.25, .8, .50, 1)`,k=!0,x=U}function Y(f,M){f.style.overflowY=null,f.style.height=null,f.style.transition=null,z(),M!==j&&p(M)}function pe(f,M){let U=0;w=f,k===!0?(z(),U=f.offsetHeight===f.scrollHeight?0:void 0):(j="hide",f.style.overflowY="hidden"),H(f,U,M),T=setTimeout(()=>{T=null,f.style.height=`${f.scrollHeight}px`,N=O=>{C=null,(Object(O)!==O||O.target===f)&&Y(f,"show")},f.addEventListener("transitionend",N),C=setTimeout(N,n.duration*1.1)},100)}function fe(f,M){let U;w=f,k===!0?z():(j="show",f.style.overflowY="hidden",U=f.scrollHeight),H(f,U,M),T=setTimeout(()=>{T=null,f.style.height=0,N=O=>{C=null,(Object(O)!==O||O.target===f)&&Y(f,"hide")},f.addEventListener("transitionend",N),C=setTimeout(N,n.duration*1.1)},100)}return Vt(()=>{k===!0&&z()}),()=>V(ua,{css:!1,appear:n.appear,onEnter:pe,onLeave:fe},l.default)}}),ve=ca({}),Ha=Object.keys($t),Oe=rt({name:"QExpansionItem",props:{...$t,...ya,...ma,icon:String,label:String,labelLines:[Number,String],caption:String,captionLines:[Number,String],dense:Boolean,toggleAriaLabel:String,expandIcon:String,expandedIcon:String,expandIconClass:[Array,String,Object],duration:{},headerInsetLevel:Number,contentInsetLevel:Number,expandSeparator:Boolean,defaultOpened:Boolean,hideExpandIcon:Boolean,expandIconToggle:Boolean,switchToggleSide:Boolean,denseToggle:Boolean,group:String,popup:Boolean,headerStyle:[Array,String,Object],headerClass:[Array,String,Object]},emits:[...ga,"click","afterShow","afterHide"],setup(n,{slots:l,emit:p}){const{proxy:{$q:k}}=va(),x=_a(n,k),w=_(n.modelValue!==null?n.modelValue:n.defaultOpened),T=_(null),C=pa(),{show:N,hide:j,toggle:z}=fa({showing:w});let H,Y;const pe=Q(()=>`q-expansion-item q-item-type q-expansion-item--${w.value===!0?"expanded":"collapsed"} q-expansion-item--${n.popup===!0?"popup":"standard"}`),fe=Q(()=>n.contentInsetLevel===void 0?null:{["padding"+(k.lang.rtl===!0?"Right":"Left")]:n.contentInsetLevel*56+"px"}),f=Q(()=>n.disable!==!0&&(n.href!==void 0||n.to!==void 0&&n.to!==null&&n.to!=="")),M=Q(()=>{const g={};return Ha.forEach($=>{g[$]=n[$]}),g}),U=Q(()=>f.value===!0||n.expandIconToggle!==!0),O=Q(()=>n.expandedIcon!==void 0&&w.value===!0?n.expandedIcon:n.expandIcon||k.iconSet.expansionItem[n.denseToggle===!0?"denseIcon":"icon"]),Te=Q(()=>n.disable!==!0&&(f.value===!0||n.expandIconToggle===!0)),G=Q(()=>({expanded:w.value===!0,detailsId:C.value,toggle:z,show:N,hide:j})),te=Q(()=>{const g=n.toggleAriaLabel!==void 0?n.toggleAriaLabel:k.lang.label[w.value===!0?"collapse":"expand"](n.label);return{role:"button","aria-expanded":w.value===!0?"true":"false","aria-controls":C.value,"aria-label":g}});Re(()=>n.group,g=>{Y?.(),g!==void 0&&se()});function q(g){f.value!==!0&&z(g),p("click",g)}function ue(g){g.keyCode===13&&ae(g,!0)}function ae(g,$){$!==!0&&g.qAvoidFocus!==!0&&T.value?.focus(),z(g),wa(g)}function he(){p("afterShow")}function ce(){p("afterHide")}function se(){H===void 0&&(H=ha()),w.value===!0&&(ve[n.group]=H);const g=Re(w,ne=>{ne===!0?ve[n.group]=H:ve[n.group]===H&&delete ve[n.group]}),$=Re(()=>ve[n.group],(ne,ze)=>{ze===H&&ne!==void 0&&ne!==H&&j()});Y=()=>{g(),$(),ve[n.group]===H&&delete ve[n.group],Y=void 0}}function ke(){const g={class:[`q-focusable relative-position cursor-pointer${n.denseToggle===!0&&n.switchToggleSide===!0?" items-end":""}`,n.expandIconClass],side:n.switchToggleSide!==!0,avatar:n.switchToggleSide},$=[V(J,{class:"q-expansion-item__toggle-icon"+(n.expandedIcon===void 0&&w.value===!0?" q-expansion-item__toggle-icon--rotated":""),name:O.value})];return Te.value===!0&&(Object.assign(g,{tabindex:0,...te.value,onClick:ae,onKeyup:ue}),$.unshift(V("div",{ref:T,class:"q-expansion-item__toggle-focus q-icon q-focus-helper q-focus-helper--rounded",tabindex:-1}))),V(ee,g,()=>$)}function be(){let g;return l.header!==void 0?g=[].concat(l.header(G.value)):(g=[V(ee,()=>[V(_e,{lines:n.labelLines},()=>n.label||""),n.caption?V(_e,{lines:n.captionLines,caption:!0},()=>n.caption):null])],n.icon&&g[n.switchToggleSide===!0?"push":"unshift"](V(ee,{side:n.switchToggleSide===!0,avatar:n.switchToggleSide!==!0},()=>V(J,{name:n.icon})))),n.disable!==!0&&n.hideExpandIcon!==!0&&g[n.switchToggleSide===!0?"unshift":"push"](ke()),g}function P(){const g={ref:"item",style:n.headerStyle,class:n.headerClass,dark:x.value,disable:n.disable,dense:n.dense,insetLevel:n.headerInsetLevel};return U.value===!0&&(g.clickable=!0,g.onClick=q,Object.assign(g,f.value===!0?M.value:te.value)),V(it,g,be)}function Me(){return je(V("div",{key:"e-content",class:"q-expansion-item__content relative-position",style:fe.value,id:C.value},ba(l.default)),[[ka,w.value]])}function we(){const g=[P(),V(Aa,{duration:n.duration,onShow:he,onHide:ce},Me)];return n.expandSeparator===!0&&g.push(V(Se,{class:"q-expansion-item__border q-expansion-item__border--top absolute-top",dark:x.value}),V(Se,{class:"q-expansion-item__border q-expansion-item__border--bottom absolute-bottom",dark:x.value})),g}return n.group!==void 0&&se(),Vt(()=>{Y?.()}),()=>V("div",{class:pe.value},[V("div",{class:"q-expansion-item__container relative-position"},we())])}}),Ua=["top","middle","bottom"],Bt=rt({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:n=>Ua.includes(n)}},setup(n,{slots:l}){const p=Q(()=>n.align!==void 0?{verticalAlign:n.align}:null),k=Q(()=>{const x=n.outline===!0&&n.color||n.textColor;return`q-badge flex inline items-center no-wrap q-badge--${n.multiLine===!0?"multi":"single"}-line`+(n.outline===!0?" q-badge--outline":n.color!==void 0?` bg-${n.color}`:"")+(x!==void 0?` text-${x}`:"")+(n.floating===!0?" q-badge--floating":"")+(n.rounded===!0?" q-badge--rounded":"")+(n.transparent===!0?" q-badge--transparent":"")});return()=>V("div",{class:k.value,style:p.value,role:"status","aria-label":n.label},Da(l.default,n.label!==void 0?[n.label]:[]))}});function It(n){if(n===!1)return 0;if(n===!0||n===void 0)return 1;const l=parseInt(n,10);return isNaN(l)?0:l}const at=xa({name:"close-popup",beforeMount(n,{value:l}){const p={depth:It(l),handler(k){p.depth!==0&&setTimeout(()=>{const x=Ta(n);x!==void 0&&qa(x,k,p.depth)})},handlerKey(k){Sa(k,13)===!0&&p.handler(k)}};n.__qclosepopup=p,n.addEventListener("click",p.handler),n.addEventListener("keyup",p.handlerKey)},updated(n,{value:l,oldValue:p}){l!==p&&(n.__qclosepopup.depth=It(l))},beforeUnmount(n){const l=n.__qclosepopup;n.removeEventListener("click",l.handler),n.removeEventListener("keyup",l.handlerKey),delete n.__qclosepopup}}),Fe="/api/beers",ie={async getAll(){return(await I.get(Fe)).data.beers||[]},async getById(n){return(await I.get(`${Fe}/${n}`)).data.beer},async create(n){const l={beer_template_id:n.beer_template_id,name:n.name,batch_id:n.batch_id,volume_hl:n.volume_hl,priority:n.priority,min_fermentation_days:n.min_fermentation_days,min_maturation_days:n.min_maturation_days,target_start_date:n.target_start_date,target_completion_date:n.target_completion_date};await I.post(Fe,l)},async update(n,l){const p={beer_id:l.beer_id,beer_template_id:l.beer_template_id||null,name:l.name,batch_id:l.batch_id||null,volume_hl:l.volume_hl,priority:l.priority,min_fermentation_days:l.min_fermentation_days,min_maturation_days:l.min_maturation_days||0,target_start_date:l.target_start_date||null,target_completion_date:l.target_completion_date||null,requires_canning:l.requires_canning||!1,tasks:l.tasks||[]};await I.put(`${Fe}/${n}`,p)},async delete(n){await I.delete(`${Fe}/${n}`)}},st="/api/canning-days",nt={async getAll(){return((await I.get(st)).data.canning_days||[]).map(p=>p.canning_day)},async create(n){await I.post(st,{canning_day:n})},async delete(n){await I.delete(`${st}/${n}`)}},ot="/api/non_working_days",lt={async getAll(){return((await I.get(ot)).data.non_working_days||[]).map(p=>p.non_working_day)},async create(n){await I.post(ot,{non_working_day:n})},async delete(n){await I.delete(`${ot}/${n}`)}},We="/api/tasks",Ne={async getById(n){return(await I.get(`${We}/${n}`)).data.task},async create(n){const l=Va();return(await I.post(We,{task_id:l,...n,locked:!0})).data},async delete(n){await I.delete(`${We}/${n}`)},async adjustDuration(n,l){return(await I.put(`${We}/${n}/duration/${l}`)).data.tasks||[]},async updateSubTask(n,l){return(await I.put(`/api/sub-tasks/${n}`,l)).data},async createSubTask(n,l){return(await I.post("/api/sub-tasks",{task_id:n,...l})).data}},Pa=(n,l)=>{const p=n.__vccOpts||n;for(const[k,x]of l)p[k]=x;return p},Ea={class:"row no-wrap",style:{height:"100%"}},Qa={class:"col-3 q-pa-md",style:{"border-right":"1px solid #e0e0e0","overflow-y":"auto"}},Oa={key:0,class:"flex flex-center q-pa-md"},Wa={key:1},Ra={class:"text-subtitle2 text-primary"},ja={class:"text-caption"},za={class:"q-pa-sm"},Ka={class:"row q-gutter-sm q-mb-md"},Ya={key:0,class:"canning-days-list"},Ga={key:1,class:"text-grey-6 text-center q-pa-sm"},Xa={class:"q-pa-sm"},Za={class:"row q-gutter-sm q-mb-md"},Ja={key:0,class:"non-working-days-list"},es={key:1,class:"text-grey-6 text-center q-pa-sm"},ts={class:"row items-center justify-between q-mb-md"},as={key:1,class:"flex flex-center q-pa-md"},ss={class:"row items-center q-gutter-xs"},ns={class:"row items-center justify-between q-mb-sm"},os={class:"beer-details"},ls={class:"detail-row"},is={class:"detail-row"},rs={class:"detail-row"},ds={class:"detail-row"},us={class:"detail-row"},cs={class:"row items-center no-wrap q-gutter-xs"},gs={class:"detail-row"},ms={class:"row items-center no-wrap q-gutter-xs"},ys={class:"detail-row"},vs={key:0,class:"q-mt-md"},_s={class:"row items-center justify-between q-mb-sm"},ps={class:"task-row"},fs={class:"task-type-label"},hs={key:0,class:"sub-tasks-list"},ks={class:"sub-task-label"},bs={key:1,class:"sub-task-day"},ws={key:3,class:"text-center text-grey-7 q-pa-md"},Ds={class:"col-9 q-pa-md"},xs={class:"row items-center justify-between q-mb-md"},Ss={class:"row items-center q-gutter-sm"},Ts={class:"text-h6"},qs={class:"schedule-table-container"},Cs={class:"schedule-table"},Bs={class:"date-label"},Is=["onClick","onContextmenu"],Vs={key:0,class:"sub-task-indicator"},$s={class:"sub-task-name"},Fs={key:1,class:"task-info"},Ns={class:"task-name"},Ms={key:0,class:"batch-id"},Ls={class:"task-type"},As=["onClick","onContextmenu"],Hs={key:0,class:"sub-task-indicator"},Us={class:"sub-task-name"},Ps={key:1,class:"task-info"},Es={class:"task-name"},Qs={key:0,class:"batch-id"},Os={class:"task-type"},Ws={class:"text-h6 text-negative"},Rs={class:"text-subtitle1 q-mb-md"},js={key:0,class:"q-mb-md"},zs={class:"text-weight-medium q-mb-sm"},Ks={key:1,class:"q-mb-md"},Ys={class:"text-weight-medium q-mb-sm"},Gs={class:"text-body2 q-ml-md"},Xs={key:2},Zs={class:"text-weight-medium q-mb-sm"},Js={key:0,class:"q-mb-sm"},en={class:"beer-diagnostic-details"},tn={class:"row q-col-gutter-sm"},an={class:"col-6"},sn={class:"col-6"},nn={class:"col-6"},on={class:"col-6"},ln={class:"col-6"},rn={key:0,class:"col-6"},dn={key:1,class:"col-6"},un={key:2,class:"col-6"},cn={key:3,class:"col-6"},gn={class:"q-mt-md text-caption text-grey-7"},mn={key:0,class:"text-caption text-grey-7"},yn={key:0,class:"q-mt-sm text-body2"},vn={__name:"SchedulePage",setup(n){const l=La(),p=_([]),k=_(null),x=_(""),w=_(null),T=_(null),C=_(2),N=_(null),j=_(null),z=_(null),H=_(null),Y=_(null),pe=_(null),fe=_(null),f=_(null),M=_(!1),U=_(!1),O=_(!1),Te=_(!1),G=_(new Date),te=_([]),q=_([]),ue=_([]),ae=_(null),he=_(!1),ce=_([]),se=_(null),ke=_(!1),be=_(!1),P=_(null),Me=_([]),we=_(!1),g=_(null),$=_(null),ne=_(!1),ze=["F6","F5","F4","F3","F2","F1","B1","B2"];Re(k,a=>{a?(w.value=a.min_fermentation_days,T.value=a.min_maturation_days):(w.value=null,T.value=null)});const Ke=Q(()=>te.value.length===0?!1:te.value.some(a=>{const t=a.tasks||[];return t.length===0?!0:!t.every(e=>e.locked)})),Ft=Q(()=>{const a=new Date(G.value),t=new Date(G.value);return t.setDate(t.getDate()+29),`${a.toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`}),Nt=Q(()=>{const a=[],t=new Date;t.setHours(0,0,0,0);for(let e=0;e<30;e++){const s=new Date(G.value);s.setDate(s.getDate()+e),s.setHours(0,0,0,0);const i=oe(s),d=s.getTime()===t.getTime(),b=s.getDay()===0||s.getDay()===6,W=Mt(s)||ce.value.includes(i);a.push({date:i,label:s.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),isToday:d,isWeekend:b,isHoliday:W,fullDate:new Date(s)})}return a}),oe=a=>{const t=a.getFullYear(),e=String(a.getMonth()+1).padStart(2,"0"),s=String(a.getDate()).padStart(2,"0");return`${t}-${e}-${s}`},Mt=a=>{const t=a.getFullYear(),e=a.getMonth()+1,s=a.getDate();if(e===1&&s===1||e===1&&s===26||e===4&&s===25||e===12&&s===25||e===12&&s===26)return!0;if(e===5){const i=new Date(t,4,1);for(;i.getDay()!==1;)i.setDate(i.getDate()+1);if(s===i.getDate())return!0}if(e===6){const i=new Date(t,5,1);for(;i.getDay()!==1;)i.setDate(i.getDate()+1);const d=new Date(i);if(d.setDate(d.getDate()+7),s===d.getDate())return!0}if(e===8){const i=new Date(t,7,1);for(;i.getDay()!==3;)i.setDate(i.getDate()+1);const d=new Date(i);if(d.setDate(d.getDate()+14),s===d.getDate())return!0}return!1},Lt=async()=>{M.value=!0;try{p.value=await $a.getAll()}catch(a){l.notify({type:"negative",message:"Failed to load beer templates",caption:a.response?.data?.message||a.message})}finally{M.value=!1}},X=async()=>{O.value=!0;try{const a=await ie.getAll();te.value=a;const t=[];for(const e of a)e.tasks&&Array.isArray(e.tasks)&&t.push(...e.tasks);q.value=t}catch(a){l.notify({type:"negative",message:"Failed to load beers",caption:a.response?.data?.message||a.message})}finally{O.value=!1}},At=async()=>{if(!(!k.value||!x.value||w.value===null||T.value===null||C.value===null)){U.value=!0;try{const a={beer_template_id:k.value.beer_template_id,name:k.value.beer_name,batch_id:x.value,volume_hl:k.value.volume_hl,priority:C.value,min_fermentation_days:w.value,min_maturation_days:T.value,target_start_date:N.value||null,target_completion_date:j.value||null};await ie.create(a),l.notify({type:"positive",message:"Beer created successfully",caption:`${a.name} ${a.batch_id}`,icon:"local_drink"}),k.value=null,x.value="",w.value=null,T.value=null,C.value=2,N.value=null,j.value=null,z.value?.resetValidation(),H.value?.resetValidation(),Y.value?.resetValidation(),pe.value?.resetValidation(),fe.value?.resetValidation(),f.value?.resetValidation(),await X(),await L()}catch(a){l.notify({type:"negative",message:"Failed to create beer",caption:a.response?.data?.message||a.message})}finally{U.value=!1}}},Le=[[229,57,53],[30,136,229],[67,160,71],[251,140,0],[142,36,170],[0,172,193],[255,179,0],[109,76,65],[216,27,96],[57,73,171],[0,137,123],[124,179,66],[244,81,30],[94,53,177],[3,155,229],[192,202,51]],re=new Map,dt=(a,t=!1)=>{if(!re.has(a)){const W=re.size%Le.length;re.set(a,W)}const e=re.get(a),[s,i,d]=Le[e];return`rgba(${s}, ${i}, ${d}, ${t?.4:.2})`},ut=a=>{if(!re.has(a)){const d=re.size%Le.length;re.set(a,d)}const t=re.get(a),[e,s,i]=Le[t];return`rgb(${e}, ${s}, ${i})`},Ht=a=>{const t=He(a),e={backgroundColor:dt(a,t)};return t&&(e.border=`2px solid ${ut(a)}`),e},ct=(a,t)=>{const e=S(a.date,t);if(e.length===0)return{};const s=e[0],i={backgroundColor:dt(s.beer_id,s.locked)};if(s.locked){const d=Ye(a.date,s),b=ut(s.beer_id);d.isSingle?i.border=`2px solid ${b}`:(i.borderLeft=`2px solid ${b}`,i.borderRight=`2px solid ${b}`,d.isFirst&&(i.borderTop=`2px solid ${b}`),d.isLast&&(i.borderBottom=`2px solid ${b}`))}return i},Ut=(a,t)=>{const e=[];for(let s=a;s<=t;s++){e.push(`${s}-01-01`),e.push(`${s}-01-26`),e.push(`${s}-04-25`),e.push(`${s}-12-25`),e.push(`${s}-12-26`);const i=s%19,d=Math.floor(s/100),b=s%100,W=Math.floor(d/4),ge=d%4,de=Math.floor((d+8)/25),Ce=Math.floor((d-de+1)/3),me=(19*i+d-W-Ce+15)%30,Je=Math.floor(b/4),Be=b%4,h=(32+2*ge+2*Je-me-Be)%7,B=Math.floor((i+11*me+22*h)/451),F=Math.floor((me+h-7*B+114)/31),Ie=(me+h-7*B+114)%31+1,le=new Date(s,F-1,Ie),ht=new Date(le);ht.setDate(le.getDate()-2);const kt=new Date(le);kt.setDate(le.getDate()-1);const bt=new Date(le);bt.setDate(le.getDate()+1),e.push(oe(ht)),e.push(oe(kt)),e.push(oe(bt));const ia=new Date(s,4,1),Ue=new Date(ia);for(;Ue.getDay()!==1;)Ue.setDate(Ue.getDate()+1);e.push(oe(Ue));const ra=new Date(s,9,1),Ve=new Date(ra);for(;Ve.getDay()!==1;)Ve.setDate(Ve.getDate()+1);const wt=new Date(Ve);wt.setDate(Ve.getDate()+7),e.push(oe(wt));const et=new Date(s,7,10),Pe=new Date(et),da=(3-et.getDay()+7)%7;Pe.setDate(et.getDate()+da),Pe.getDate()>=10&&Pe.getDate()<=16&&e.push(oe(Pe))}return e},L=async()=>{if(Ke.value){Te.value=!0;try{const a=new Date;a.setHours(0,0,0,0);const t=h=>{const B=new Date(h);B.setHours(0,0,0,0);const F=B.getTime()-a.getTime();return Math.floor(F/(1e3*60*60*24))},e=h=>h?t(h):null,s=[],i=[],d=[];for(const h of te.value){const B=(h.tasks||[]).filter(F=>F.locked);if(B.length>0){s.push(h);for(const F of B){const Ie=t(F.start_date),le=t(F.end_date)+1;le>=1&&d.push({resource:F.resource,start_day:Ie,end_day:le})}}else{const F=e(h.target_start_date),Ie=F!==null?Math.max(1,F):null;i.push({id:h.beer_id,name:h.name,volume_hl:h.volume_hl,priority:h.priority,min_fermentation_days:h.min_fermentation_days,min_maturation_days:h.min_maturation_days||0,requires_canning:h.requires_canning||!1,target_start_day:Ie,target_completion_day:e(h.target_completion_date),tasks:[]})}}const b=new Date().getFullYear(),W=Ut(b,b+1),ge=[...new Set([...W,...ce.value])],de={beers:i,canning_days:ue.value,non_working_days:ge};d.length>0&&(de.resource_blocks=d);const Ce=await I.post("/api/schedule",de),me=h=>{const B=new Date(a);return B.setDate(B.getDate()+h),oe(B)},Je=Ce.data.beers||[],Be=[];for(const h of Je)if(h.tasks&&Array.isArray(h.tasks))for(const B of h.tasks)Be.push({...B,beer_id:h.id,beer_name:h.name,batch_id:h.batch_id,start_date:me(B.start_day),end_date:me(B.end_day-1)});for(const h of s){const B=(h.tasks||[]).filter(F=>F.locked);for(const F of B)Be.push({...F,beer_id:h.beer_id,beer_name:h.name,batch_id:h.batch_id})}q.value=Be,l.notify({type:"positive",message:"Beers scheduled successfully",icon:"calendar_today"})}catch(a){console.error("Schedule error:",a);const t=a.response?.data;t?.error==="SCHEDULING_ERROR"&&t?.diagnostic?(P.value=t,be.value=!0):t?.error==="INFEASIBLE"&&t?.beer_diagnostics?(P.value={error:t.error,message:t.message,diagnostic:{solver_status:t.solver_status,warnings:t.warnings,beer_diagnostics:t.beer_diagnostics,canning:t.canning,equipment:t.equipment}},be.value=!0):l.notify({type:"negative",message:"Failed to schedule beers",caption:t?.message||a.message})}finally{Te.value=!1}}},S=(a,t)=>{const e=t.toLowerCase();return q.value.filter(s=>{if(s.resource.toLowerCase()!==e)return!1;const i=new Date(s.start_date),d=new Date(s.end_date),b=new Date(a);return i.setHours(0,0,0,0),d.setHours(0,0,0,0),b.setHours(0,0,0,0),b>=i&&b<=d})},Ye=(a,t)=>{const e=new Date(t.start_date),s=new Date(t.end_date),i=new Date(a);e.setHours(0,0,0,0),s.setHours(0,0,0,0),i.setHours(0,0,0,0);const d=i.getTime()===e.getTime(),b=i.getTime()===s.getTime(),W=Math.round((s-e)/(1e3*60*60*24))+1,ge=Math.floor(W/2),de=new Date(e);de.setDate(de.getDate()+ge);const Ce=i.getTime()===de.getTime();return{isFirst:d,isLast:b,isMiddle:Ce,isSingle:d&&b}},gt=(a,t)=>{const e=Ye(a,t);return e.isMiddle||e.isSingle},Ge=(a,t)=>{const e=S(a,t);if(e.length===0)return[];const s=e[0];if(!s.sub_tasks||s.sub_tasks.length===0)return[];const i=new Date;i.setHours(0,0,0,0);const d=new Date(a);d.setHours(0,0,0,0);const b=Math.round((d-i)/(1e3*60*60*24));return s.sub_tasks.filter(W=>s.start_day+W.day===b)},De=(a,t)=>Ge(a,t).length>0,Ae=a=>q.value.filter(t=>t.beer_id===a),He=a=>{const t=Ae(a);return t.length===0?!1:t.every(e=>e.locked)},Pt=async(a,t)=>{const e=Ae(a.beer_id);if(e.length!==0)try{if(t){for(const s of e)if(!s.locked){const i=await Ne.create({beer_id:a.beer_id,beer_name:a.name,task_type:s.task_type,start_day:s.start_day,start_date:s.start_date,duration:s.duration,end_day:s.end_day,end_date:s.end_date,resource:s.resource,volume_hl:a.volume_hl}),d=q.value.findIndex(b=>b.beer_id===a.beer_id&&b.task_type===s.task_type);d!==-1&&(q.value[d]={...q.value[d],task_id:i.task_id,locked:!0})}l.notify({type:"positive",message:"All tasks pinned",caption:a.name,icon:"push_pin"})}else{for(const s of e)if(s.locked&&s.task_id){await Ne.delete(s.task_id);const i=q.value.findIndex(d=>d.beer_id===a.beer_id&&d.task_type===s.task_type);i!==-1&&(q.value[i]={...q.value[i],task_id:null,locked:!1})}l.notify({type:"positive",message:"All tasks unpinned",caption:a.name,icon:"push_pin"})}}catch(s){l.notify({type:"negative",message:t?"Failed to pin tasks":"Failed to unpin tasks",caption:s.response?.data?.message||s.message})}},Et=async(a,t,e)=>{if(!t.sub_task_id)return;const s=Number(e);if(!(isNaN(s)||s<0))try{await Ne.updateSubTask(t.sub_task_id,{day:s});const i=q.value.findIndex(d=>d.task_id===a.task_id);if(i!==-1){const d=q.value[i].sub_tasks?.findIndex(b=>b.sub_task_id===t.sub_task_id);d!==-1&&d!==void 0&&(q.value[i].sub_tasks[d].day=s)}l.notify({type:"positive",message:"Sub-task day updated",icon:"check"})}catch(i){l.notify({type:"negative",message:"Failed to update sub-task day",caption:i.response?.data?.message||i.message})}},mt=(a,t,e)=>{const s=S(t,e);if(s.length===0)return;const i=s[0];if(!i.locked||!i.task_id)return;const d=new Date;d.setHours(0,0,0,0);const b=new Date(t);b.setHours(0,0,0,0);const ge=Math.round((b-d)/(1e3*60*60*24))-i.start_day;g.value={task:i,date:t,dayOffset:ge},$.value=null,we.value=!0},Qt=async()=>{if(!(!g.value||!$.value)){ne.value=!0;try{const{task:a,dayOffset:t}=g.value,e=await Ne.createSubTask(a.task_id,{sub_task_name:$.value,day:t}),s=q.value.findIndex(i=>i.task_id===a.task_id);s!==-1&&(q.value[s].sub_tasks||(q.value[s].sub_tasks=[]),q.value[s].sub_tasks.push(e.sub_task||e)),l.notify({type:"positive",message:"Sub-task added",icon:"check"}),we.value=!1}catch(a){l.notify({type:"negative",message:"Failed to add sub-task",caption:a.response?.data?.message||a.message})}finally{ne.value=!1}}},Ot=async()=>{try{Me.value=await Fa.getAll()}catch(a){console.error("Failed to load sub-task names:",a)}},yt=(a,t)=>{const e=S(a.date,t),s=e.length>0,i={today:a.isToday,weekend:a.isWeekend,holiday:a.isHoliday,"has-task":s};if(s){const d=Ye(a.date,e[0]);i["task-first"]=d.isFirst&&!d.isSingle,i["task-last"]=d.isLast&&!d.isSingle,i["task-middle"]=!d.isFirst&&!d.isLast,i["task-single"]=d.isSingle}return i},Wt=a=>{l.notify({type:"info",message:`Viewing ${a.name}`,caption:"Feature coming soon..."})},vt=async(a,t)=>{if(t)if(t.locked&&t.task_id&&(a.metaKey||a.ctrlKey)){const e=a.shiftKey?-1:1;try{await Ne.adjustDuration(t.task_id,e),l.notify({type:"positive",message:`Task duration ${e>0?"increased":"decreased"} by 1 day`,icon:"schedule"}),await X(),await L()}catch(s){l.notify({type:"negative",message:"Failed to adjust task duration",caption:s.response?.data?.message||s.message})}}else Wt(t)},Rt=a=>{l.dialog({title:"Confirm Delete",message:`Are you sure you want to delete ${a.name} (${a.batch_id})?`,cancel:!0,persistent:!0}).onOk(async()=>{await jt(a.beer_id)})},jt=async a=>{try{await ie.delete(a),l.notify({type:"positive",message:"Beer deleted successfully",icon:"delete"}),await X(),await L()}catch(t){l.notify({type:"negative",message:"Failed to delete beer",caption:t.response?.data?.message||t.message})}},zt=async(a,t)=>{try{const e=Number(t);if(isNaN(e)||e<=0){l.notify({type:"negative",message:"Invalid volume",caption:"Must be greater than 0"});return}const s={...a,volume_hl:e};await ie.update(a.beer_id,s),l.notify({type:"positive",message:"Volume updated successfully",icon:"check"}),await X(),await L()}catch(e){l.notify({type:"negative",message:"Failed to update volume",caption:e.response?.data?.message||e.message})}},Kt=async(a,t)=>{try{const e={...a,priority:t};await ie.update(a.beer_id,e),l.notify({type:"positive",message:"Priority updated successfully",icon:"check"}),await X(),await L()}catch(e){l.notify({type:"negative",message:"Failed to update priority",caption:e.response?.data?.message||e.message})}},Yt=async(a,t)=>{try{const e=Number(t);if(isNaN(e)||e<0){l.notify({type:"negative",message:"Invalid fermentation days",caption:"Must be 0 or greater"});return}const s={...a,min_fermentation_days:e};await ie.update(a.beer_id,s),l.notify({type:"positive",message:"Min fermentation days updated successfully",icon:"check"}),await X(),await L()}catch(e){l.notify({type:"negative",message:"Failed to update min fermentation days",caption:e.response?.data?.message||e.message})}},_t=async(a,t)=>{try{const e={...a,target_start_date:t||null};await ie.update(a.beer_id,e),l.notify({type:"positive",message:"Target start date updated successfully",icon:"check"}),await X(),await L()}catch(e){l.notify({type:"negative",message:"Failed to update target start date",caption:e.response?.data?.message||e.message})}},pt=async(a,t)=>{try{const e={...a,target_completion_date:t||null};await ie.update(a.beer_id,e),l.notify({type:"positive",message:"Target completion date updated successfully",icon:"check"}),await X(),await L()}catch(e){l.notify({type:"negative",message:"Failed to update target completion date",caption:e.response?.data?.message||e.message})}},Gt=async(a,t)=>{try{const e={...a,requires_canning:t};await ie.update(a.beer_id,e),l.notify({type:"positive",message:"Requires canning updated successfully",icon:"check"}),await X(),await L()}catch(e){l.notify({type:"negative",message:"Failed to update requires canning",caption:e.response?.data?.message||e.message})}},Xt=()=>{const a=new Date(G.value);a.setDate(a.getDate()-30),G.value=a},Zt=()=>{const a=new Date(G.value);a.setDate(a.getDate()+30),G.value=a},Jt=()=>{G.value=new Date},ea=a=>{switch(a){case 5:return"red";case 4:return"orange";case 3:return"amber";case 2:return"blue";case 1:return"grey";default:return"grey"}},Xe=async()=>{try{ue.value=await nt.getAll()}catch(a){console.error("Failed to load canning days:",a)}},ta=a=>ue.value.includes(a),aa=async()=>{if(ae.value){he.value=!0;try{await nt.create(ae.value),await Xe(),ae.value=null,l.notify({type:"positive",message:"Canning day added",icon:"event"}),await L()}catch(a){l.notify({type:"negative",message:"Failed to add canning day",caption:a.response?.data?.message||a.message})}finally{he.value=!1}}},sa=async a=>{try{await nt.delete(a),await Xe(),l.notify({type:"positive",message:"Canning day removed",icon:"event_busy"}),await L()}catch(t){l.notify({type:"negative",message:"Failed to remove canning day",caption:t.response?.data?.message||t.message})}},Ze=async()=>{try{ce.value=await lt.getAll()}catch(a){console.error("Failed to load non-working days:",a)}},na=async()=>{if(se.value){ke.value=!0;try{await lt.create(se.value),await Ze(),se.value=null,l.notify({type:"positive",message:"Non-working day added",icon:"event"}),await L()}catch(a){l.notify({type:"negative",message:"Failed to add non-working day",caption:a.response?.data?.message||a.message})}finally{ke.value=!1}}},oa=async a=>{try{await lt.delete(a),await Ze(),l.notify({type:"positive",message:"Non-working day removed",icon:"event_busy"}),await L()}catch(t){l.notify({type:"negative",message:"Failed to remove non-working day",caption:t.response?.data?.message||t.message})}},ft=a=>new Date(a).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),qe=a=>{if(a==null)return null;const t=new Date;t.setHours(0,0,0,0);const e=new Date(t);return e.setDate(e.getDate()+a),oe(e)},la=a=>!a||a.length===0?"None":a.map(t=>qe(t)).join(", ");return Ca(async()=>{await Promise.all([Lt(),X(),Xe(),Ze(),Ot()]),await L()}),(a,t)=>(u(),A(Ma,{class:"schedule-page"},{default:c(()=>[o("div",Ea,[o("div",Qa,[t[30]||(t[30]=o("div",{class:"text-h5 q-mb-md"},"Create Beer",-1)),M.value?(u(),y("div",Oa,[r(Dt,{color:"primary",size:"md"})])):(u(),y("div",Wa,[r(Qe,{modelValue:k.value,"onUpdate:modelValue":t[0]||(t[0]=e=>k.value=e),options:p.value,"option-label":"beer_name","option-value":"beer_template_id",label:"Select Beer Template",outlined:"",disable:!p.value||p.value.length===0},{"no-option":c(()=>[r(it,null,{default:c(()=>[r(ee,{class:"text-grey"},{default:c(()=>[...t[12]||(t[12]=[v(" No templates available ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","options","disable"]),k.value?(u(),A($e,{key:0,flat:"",bordered:"",class:"q-mt-md"},{default:c(()=>[r(ye,null,{default:c(()=>[o("div",Ra,m(k.value.beer_name),1),r(Se,{class:"q-my-sm"}),o("div",ja,[o("div",null,[t[13]||(t[13]=o("strong",null,"Volume:",-1)),v(" "+m(k.value.volume_hl)+" hl",1)]),o("div",null,[t[14]||(t[14]=o("strong",null,"Maturation:",-1)),v(" "+m(k.value.min_maturation_days)+" days",1)])]),r(Se,{class:"q-my-sm"}),r(R,{ref_key:"batchIdInput",ref:z,modelValue:x.value,"onUpdate:modelValue":t[1]||(t[1]=e=>x.value=e),label:"Batch ID *",outlined:"",dense:"",class:"q-mt-sm",rules:[e=>!!e||"Batch ID is required"]},null,8,["modelValue","rules"]),r(R,{ref_key:"minFermentationDaysInput",ref:H,modelValue:w.value,"onUpdate:modelValue":t[2]||(t[2]=e=>w.value=e),modelModifiers:{number:!0},label:"Min Fermentation Days *",type:"number",outlined:"",dense:"",class:"q-mt-sm",rules:[e=>e!==null&&e!==""&&e!==void 0||"Min fermentation days is required",e=>e>=0||"Must be 0 or greater"]},null,8,["modelValue","rules"]),r(R,{ref_key:"minMaturationDaysInput",ref:Y,modelValue:T.value,"onUpdate:modelValue":t[3]||(t[3]=e=>T.value=e),modelModifiers:{number:!0},label:"Min Maturation Days *",type:"number",outlined:"",dense:"",class:"q-mt-sm",rules:[e=>e!==null&&e!==""&&e!==void 0||"Min maturation days is required",e=>e>=0||"Must be 0 or greater"]},null,8,["modelValue","rules"]),r(Qe,{ref_key:"priorityInput",ref:pe,modelValue:C.value,"onUpdate:modelValue":t[4]||(t[4]=e=>C.value=e),options:[1,2,3],label:"Priority *",outlined:"",dense:"",class:"q-mt-sm",rules:[e=>e!=null||"Priority is required"]},null,8,["modelValue","rules"]),r(R,{ref_key:"targetStartDateInput",ref:fe,modelValue:N.value,"onUpdate:modelValue":t[5]||(t[5]=e=>N.value=e),label:"Target Start Date",outlined:"",dense:"",type:"date",class:"q-mt-sm"},null,8,["modelValue"]),r(R,{ref_key:"targetDateInput",ref:f,modelValue:j.value,"onUpdate:modelValue":t[6]||(t[6]=e=>j.value=e),label:"Target Completion Date",outlined:"",dense:"",type:"date",class:"q-mt-sm"},null,8,["modelValue"]),r(E,{color:"primary",icon:"add",label:"Create Beer",class:"full-width q-mt-md",disable:!x.value||w.value===null||T.value===null||C.value===null||U.value,loading:U.value,onClick:At},null,8,["disable","loading"])]),_:1})]),_:1})):D("",!0),r(Se,{class:"q-my-md"}),r(Oe,{icon:"event",label:"Canning Days","header-class":"text-h6",dense:""},{default:c(()=>[o("div",za,[o("div",Ka,[r(R,{modelValue:ae.value,"onUpdate:modelValue":t[7]||(t[7]=e=>ae.value=e),type:"date",label:"Add Canning Day",outlined:"",dense:"",class:"col"},null,8,["modelValue"]),r(E,{color:"primary",icon:"add",disable:!ae.value||he.value,loading:he.value,onClick:aa},{default:c(()=>[r(xe,null,{default:c(()=>[...t[15]||(t[15]=[v("Add Canning Day",-1)])]),_:1})]),_:1},8,["disable","loading"])]),ue.value.length>0?(u(),y("div",Ya,[(u(!0),y(K,null,Z(ue.value,e=>(u(),A(qt,{key:e,removable:"",color:"red","text-color":"white",onRemove:s=>sa(e)},{default:c(()=>[v(m(ft(e)),1)]),_:2},1032,["onRemove"]))),128))])):(u(),y("div",Ga," No canning days scheduled "))])]),_:1}),r(Oe,{icon:"event_busy",label:"Non-Working Days","header-class":"text-h6",dense:""},{default:c(()=>[o("div",Xa,[o("div",Za,[r(R,{modelValue:se.value,"onUpdate:modelValue":t[8]||(t[8]=e=>se.value=e),type:"date",label:"Add Non-Working Day",outlined:"",dense:"",class:"col"},null,8,["modelValue"]),r(E,{color:"primary",icon:"add",disable:!se.value||ke.value,loading:ke.value,onClick:na},{default:c(()=>[r(xe,null,{default:c(()=>[...t[16]||(t[16]=[v("Add Non-Working Day",-1)])]),_:1})]),_:1},8,["disable","loading"])]),ce.value.length>0?(u(),y("div",Ja,[(u(!0),y(K,null,Z(ce.value,e=>(u(),A(qt,{key:e,removable:"",color:"grey","text-color":"white",onRemove:s=>oa(e)},{default:c(()=>[v(m(ft(e)),1)]),_:2},1032,["onRemove"]))),128))])):(u(),y("div",es," No non-working days scheduled "))])]),_:1}),r(Se,{class:"q-my-md"}),o("div",ts,[t[17]||(t[17]=o("div",{class:"text-h6"},"Batches",-1)),r(E,{flat:"",dense:"",round:"",icon:"calendar_today",size:"sm",color:"primary",loading:Te.value,disable:!Ke.value,onClick:L},{default:c(()=>[r(xe,null,{default:c(()=>[v(m(Ke.value?"Schedule Beers":"No beers to schedule"),1)]),_:1})]),_:1},8,["loading","disable"])]),O.value?(u(),y("div",as,[r(Dt,{color:"primary",size:"md"})])):te.value.length>0?(u(),A(Ct,{key:2},{default:c(()=>[(u(!0),y(K,null,Z(te.value,e=>(u(),A(Oe,{key:e.beer_id,"expand-separator":"",class:Ee(["color-indicator",{"beer-locked":He(e.beer_id)}]),style:tt(Ht(e.beer_id))},{header:c(()=>[r(ee,null,{default:c(()=>[r(_e,null,{default:c(()=>[v(m(e.name),1)]),_:2},1024),r(_e,{caption:""},{default:c(()=>[v(m(e.batch_id),1)]),_:2},1024)]),_:2},1024),r(ee,{side:""},{default:c(()=>[o("div",ss,[He(e.beer_id)?(u(),A(J,{key:0,name:"lock",size:"xs",color:"grey-7"})):D("",!0),r(Bt,{color:ea(e.priority)},{default:c(()=>[v(" P"+m(e.priority),1)]),_:2},1032,["color"])])]),_:2},1024)]),default:c(()=>[r($e,{flat:""},{default:c(()=>[r(ye,{class:"q-pt-none"},{default:c(()=>[o("div",ns,[t[19]||(t[19]=o("div",{class:"text-subtitle2"},"Beer Details",-1)),r(E,{flat:"",dense:"",round:"",icon:"delete",color:"negative",size:"sm",onClick:s=>Rt(e)},{default:c(()=>[r(xe,null,{default:c(()=>[...t[18]||(t[18]=[v("Delete Beer",-1)])]),_:1})]),_:1},8,["onClick"])]),o("div",os,[o("div",ls,[t[20]||(t[20]=o("span",{class:"detail-label"},"Batch ID:",-1)),o("span",null,m(e.batch_id),1)]),o("div",is,[t[21]||(t[21]=o("span",{class:"detail-label"},"Volume:",-1)),r(R,{"model-value":e.volume_hl,type:"number",suffix:"hl",dense:"",outlined:"",style:{"max-width":"100px"},rules:[s=>s>0||"Must be greater than 0"],"onUpdate:modelValue":s=>zt(e,s)},null,8,["model-value","rules","onUpdate:modelValue"])]),o("div",rs,[t[22]||(t[22]=o("span",{class:"detail-label"},"Priority:",-1)),r(Qe,{"model-value":e.priority,options:[1,2,3],dense:"",outlined:"",style:{"max-width":"80px"},"onUpdate:modelValue":s=>Kt(e,s)},null,8,["model-value","onUpdate:modelValue"])]),o("div",ds,[t[23]||(t[23]=o("span",{class:"detail-label"},"Min Fermentation:",-1)),r(R,{"model-value":e.min_fermentation_days,type:"number",suffix:"days",dense:"",outlined:"",style:{"max-width":"120px"},rules:[s=>s>=0||"Must be 0 or greater"],onChange:s=>Yt(e,s.target.value)},null,8,["model-value","rules","onChange"])]),o("div",us,[t[25]||(t[25]=o("span",{class:"detail-label"},"Target Start:",-1)),o("div",cs,[r(R,{"model-value":e.target_start_date||"",type:"date",dense:"",outlined:"",style:{"max-width":"150px"},"onUpdate:modelValue":s=>_t(e,s)},null,8,["model-value","onUpdate:modelValue"]),e.target_start_date?(u(),A(E,{key:0,flat:"",round:"",dense:"",size:"sm",icon:"close",color:"grey",onClick:s=>_t(e,null)},{default:c(()=>[r(xe,null,{default:c(()=>[...t[24]||(t[24]=[v("Clear target start date",-1)])]),_:1})]),_:1},8,["onClick"])):D("",!0)])]),o("div",gs,[t[27]||(t[27]=o("span",{class:"detail-label"},"Target Completion:",-1)),o("div",ms,[r(R,{"model-value":e.target_completion_date||"",type:"date",dense:"",outlined:"",style:{"max-width":"150px"},"onUpdate:modelValue":s=>pt(e,s)},null,8,["model-value","onUpdate:modelValue"]),e.target_completion_date?(u(),A(E,{key:0,flat:"",round:"",dense:"",size:"sm",icon:"close",color:"grey",onClick:s=>pt(e,null)},{default:c(()=>[r(xe,null,{default:c(()=>[...t[26]||(t[26]=[v("Clear target completion date",-1)])]),_:1})]),_:1},8,["onClick"])):D("",!0)])]),o("div",ys,[t[28]||(t[28]=o("span",{class:"detail-label"},"Requires Canning:",-1)),r(Ba,{"model-value":e.requires_canning||!1,dense:"","onUpdate:modelValue":s=>Gt(e,s)},null,8,["model-value","onUpdate:modelValue"])])]),Ae(e.beer_id).length>0?(u(),y("div",vs,[o("div",_s,[t[29]||(t[29]=o("div",{class:"text-subtitle2"},"Scheduled Tasks",-1)),r(Ia,{"model-value":He(e.beer_id),label:"Pin All",dense:"",size:"sm","onUpdate:modelValue":s=>Pt(e,s)},null,8,["model-value","onUpdate:modelValue"])]),(u(!0),y(K,null,Z(Ae(e.beer_id),s=>(u(),y("div",{key:`${e.beer_id}-${s.task_type}`,class:"task-item"},[o("div",ps,[o("span",fs,m(s.task_type),1),s.locked?(u(),A(J,{key:0,name:"push_pin",size:"xs",color:"primary"})):D("",!0)]),s.sub_tasks&&s.sub_tasks.length>0?(u(),y("div",hs,[(u(!0),y(K,null,Z(s.sub_tasks,i=>(u(),y("div",{key:i.sub_task_id,class:"sub-task-row"},[o("span",ks,m(i.sub_task_name),1),s.locked?(u(),A(R,{key:0,"model-value":i.day,type:"number",dense:"",outlined:"",class:"sub-task-day-input","onUpdate:modelValue":d=>Et(s,i,d)},null,8,["model-value","onUpdate:modelValue"])):(u(),y("span",bs,"Day "+m(i.day),1))]))),128))])):D("",!0)]))),128))])):D("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["class","style"]))),128))]),_:1})):(u(),y("div",ws," No beers scheduled yet "))]))]),o("div",Ds,[o("div",xs,[t[31]||(t[31]=o("div",{class:"text-h4"},"Schedule",-1)),o("div",Ss,[r(E,{flat:"",dense:"",round:"",icon:"chevron_left",onClick:Xt}),o("div",Ts,m(Ft.value),1),r(E,{flat:"",dense:"",round:"",icon:"chevron_right",onClick:Zt}),r(E,{flat:"",label:"Today",onClick:Jt})])]),o("div",qs,[o("div",Cs,[t[32]||(t[32]=o("div",{class:"schedule-header"},"Date",-1)),t[33]||(t[33]=o("div",{class:"schedule-header"},"Brewhouse",-1)),t[34]||(t[34]=o("div",{class:"schedule-header"},[o("div",null,"F6"),o("div",{class:"volume-label"},"20hl")],-1)),t[35]||(t[35]=o("div",{class:"schedule-header"},[o("div",null,"F5"),o("div",{class:"volume-label"},"20hl")],-1)),t[36]||(t[36]=o("div",{class:"schedule-header"},[o("div",null,"F4"),o("div",{class:"volume-label"},"20hl")],-1)),t[37]||(t[37]=o("div",{class:"schedule-header"},[o("div",null,"F3"),o("div",{class:"volume-label"},"20hl")],-1)),t[38]||(t[38]=o("div",{class:"schedule-header"},[o("div",null,"F2"),o("div",{class:"volume-label"},"10hl")],-1)),t[39]||(t[39]=o("div",{class:"schedule-header"},[o("div",null,"F1"),o("div",{class:"volume-label"},"10hl")],-1)),t[40]||(t[40]=o("div",{class:"schedule-header"},[o("div",null,"B1"),o("div",{class:"volume-label"},"10hl")],-1)),t[41]||(t[41]=o("div",{class:"schedule-header"},[o("div",null,"B2"),o("div",{class:"volume-label"},"20hl")],-1)),(u(!0),y(K,null,Z(Nt.value,e=>(u(),y(K,{key:e.date},[o("div",{class:Ee(["schedule-cell date-cell",{today:e.isToday,weekend:e.isWeekend,holiday:e.isHoliday,"canning-day":ta(e.date)}])},[o("div",Bs,m(e.label),1)],2),o("div",{class:Ee(["schedule-cell tank-cell",[yt(e,"Brewhouse"),{"has-sub-task":De(e.date,"Brewhouse"),"sub-task-non-working":De(e.date,"Brewhouse")&&e.isHoliday}]]),style:tt(ct(e,"Brewhouse")),onClick:s=>S(e.date,"Brewhouse").length>0?vt(s,S(e.date,"Brewhouse")[0]):null,onContextmenu:xt(s=>mt(s,e.date,"Brewhouse"),["prevent"])},[De(e.date,"Brewhouse")?(u(),y("div",Vs,[o("span",$s,m(Ge(e.date,"Brewhouse").map(s=>s.sub_task_name).join(", ")),1)])):S(e.date,"Brewhouse").length>0&&gt(e.date,S(e.date,"Brewhouse")[0])?(u(),y("div",Fs,[o("div",Ns,[v(m(S(e.date,"Brewhouse")[0].beer_name)+" ",1),S(e.date,"Brewhouse")[0].batch_id?(u(),y("span",Ms,m(S(e.date,"Brewhouse")[0].batch_id),1)):D("",!0)]),o("div",Ls,m(S(e.date,"Brewhouse")[0].task_type),1)])):D("",!0)],46,Is),(u(),y(K,null,Z(ze,s=>o("div",{key:`${e.date}-${s}`,class:Ee(["schedule-cell tank-cell",[yt(e,s),{"has-sub-task":De(e.date,s),"sub-task-non-working":De(e.date,s)&&e.isHoliday}]]),style:tt(ct(e,s)),onClick:i=>S(e.date,s).length>0?vt(i,S(e.date,s)[0]):null,onContextmenu:xt(i=>mt(i,e.date,s),["prevent"])},[De(e.date,s)?(u(),y("div",Hs,[o("span",Us,m(Ge(e.date,s).map(i=>i.sub_task_name).join(", ")),1)])):S(e.date,s).length>0&&gt(e.date,S(e.date,s)[0])?(u(),y("div",Ps,[o("div",Es,[v(m(S(e.date,s)[0].beer_name)+" ",1),S(e.date,s)[0].batch_id?(u(),y("span",Qs,m(S(e.date,s)[0].batch_id),1)):D("",!0)]),o("div",Os,m(S(e.date,s)[0].task_type),1)])):D("",!0)],46,As)),64))],64))),128))])])])]),r(St,{modelValue:be.value,"onUpdate:modelValue":t[9]||(t[9]=e=>be.value=e),persistent:""},{default:c(()=>[r($e,{style:{"min-width":"500px","max-width":"700px"}},{default:c(()=>[r(ye,{class:"row items-center q-pb-none"},{default:c(()=>[o("div",Ws,[r(J,{name:"error",class:"q-mr-sm"}),t[42]||(t[42]=v(" Scheduling Failed ",-1))]),r(Na),je(r(E,{icon:"close",flat:"",round:"",dense:""},null,512),[[at]])]),_:1}),P.value?(u(),A(ye,{key:0},{default:c(()=>[o("div",Rs,m(P.value.message),1),P.value.diagnostic?.warnings?.length>0?(u(),y("div",js,[o("div",zs,[r(J,{name:"warning",color:"warning",class:"q-mr-xs"}),t[43]||(t[43]=v(" Warnings ",-1))]),r(Ct,{dense:"",bordered:"",separator:"",class:"rounded-borders"},{default:c(()=>[(u(!0),y(K,null,Z(P.value.diagnostic.warnings,(e,s)=>(u(),A(it,{key:s},{default:c(()=>[r(ee,null,{default:c(()=>[r(_e,{class:"text-body2"},{default:c(()=>[v(m(e),1)]),_:2},1024)]),_:2},1024)]),_:2},1024))),128))]),_:1})])):D("",!0),P.value.diagnostic?.canning?(u(),y("div",Ks,[o("div",Ys,[r(J,{name:"inventory_2",color:"primary",class:"q-mr-xs"}),t[44]||(t[44]=v(" Canning Constraints ",-1))]),o("div",Gs,[o("div",null,[t[45]||(t[45]=o("strong",null,"Available canning days:",-1)),v(" "+m(la(P.value.diagnostic.canning.available_days)),1)]),o("div",null,[t[46]||(t[46]=o("strong",null,"Beers requiring canning:",-1)),v(" "+m(P.value.diagnostic.canning.beers_requiring_canning),1)])])])):D("",!0),P.value.diagnostic?.beer_diagnostics?.length>0?(u(),y("div",Xs,[o("div",Zs,[r(J,{name:"sports_bar",color:"amber",class:"q-mr-xs"}),t[47]||(t[47]=v(" Beer Details ",-1))]),(u(!0),y(K,null,Z(P.value.diagnostic.beer_diagnostics,e=>(u(),A(Oe,{key:e.id,dense:"","expand-separator":"","header-class":e.warnings?.length>0?"text-negative":""},{header:c(()=>[r(ee,{avatar:""},{default:c(()=>[r(J,{name:e.warnings?.length>0?"error":"check_circle",color:e.warnings?.length>0?"negative":"positive",size:"sm"},null,8,["name","color"])]),_:2},1024),r(ee,null,{default:c(()=>[r(_e,null,{default:c(()=>[v(m(e.name),1)]),_:2},1024),r(_e,{caption:""},{default:c(()=>[v(m(e.volume_hl)+" hl",1)]),_:2},1024)]),_:2},1024),e.warnings?.length>0?(u(),A(ee,{key:0,side:""},{default:c(()=>[r(Bt,{color:"negative"},{default:c(()=>[v(m(e.warnings.length)+" warning(s)",1)]),_:2},1024)]),_:2},1024)):D("",!0)]),default:c(()=>[r($e,{flat:""},{default:c(()=>[r(ye,{class:"q-pt-none"},{default:c(()=>[e.warnings?.length>0?(u(),y("div",Js,[(u(!0),y(K,null,Z(e.warnings,(s,i)=>(u(),y("div",{key:i,class:"text-negative text-body2 q-mb-xs"},[r(J,{name:"warning",size:"xs",class:"q-mr-xs"}),v(" "+m(s),1)]))),128))])):D("",!0),o("div",en,[o("div",tn,[o("div",an,[t[48]||(t[48]=o("span",{class:"text-grey-7"},"Brew days:",-1)),v(" "+m(e.brew_days),1)]),o("div",sn,[t[49]||(t[49]=o("span",{class:"text-grey-7"},"Min fermentation:",-1)),v(" "+m(e.min_fermentation_days)+" days ",1)]),o("div",nn,[t[50]||(t[50]=o("span",{class:"text-grey-7"},"Min maturation:",-1)),v(" "+m(e.min_maturation_days)+" days ",1)]),o("div",on,[t[51]||(t[51]=o("span",{class:"text-grey-7"},"Min to completion:",-1)),v(" "+m(e.min_days_to_completion)+" days ",1)]),o("div",ln,[t[52]||(t[52]=o("span",{class:"text-grey-7"},"Requires canning:",-1)),v(" "+m(e.requires_canning?"Yes":"No"),1)]),e.target_start_day!==null?(u(),y("div",rn,[t[53]||(t[53]=o("span",{class:"text-grey-7"},"Target start:",-1)),v(" "+m(qe(e.target_start_day)),1)])):D("",!0),e.target_completion_day!==null?(u(),y("div",dn,[t[54]||(t[54]=o("span",{class:"text-grey-7"},"Target completion:",-1)),v(" "+m(qe(e.target_completion_day)),1)])):D("",!0),e.earliest_possible_completion!==null&&e.earliest_possible_completion!==void 0?(u(),y("div",un,[t[55]||(t[55]=o("span",{class:"text-grey-7"},"Earliest completion:",-1)),v(" "+m(qe(e.earliest_possible_completion)),1)])):D("",!0),e.earliest_feasible_canning_day!==null?(u(),y("div",cn,[t[56]||(t[56]=o("span",{class:"text-grey-7"},"Earliest canning:",-1)),v(" "+m(qe(e.earliest_feasible_canning_day)),1)])):D("",!0)])])]),_:2},1024)]),_:2},1024)]),_:2},1032,["header-class"]))),128))])):D("",!0),o("div",gn," Solver status: "+m(P.value.diagnostic?.solver_status),1)]),_:1})):D("",!0),r(Tt,{align:"right"},{default:c(()=>[je(r(E,{flat:"",label:"Close",color:"primary"},null,512),[[at]])]),_:1})]),_:1})]),_:1},8,["modelValue"]),r(St,{modelValue:we.value,"onUpdate:modelValue":t[11]||(t[11]=e=>we.value=e)},{default:c(()=>[r($e,{style:{"min-width":"350px"}},{default:c(()=>[r(ye,null,{default:c(()=>[t[57]||(t[57]=o("div",{class:"text-h6"},"Add Sub-Task",-1)),g.value?(u(),y("div",mn,m(g.value.task.beer_name)+" - "+m(g.value.task.task_type),1)):D("",!0)]),_:1}),r(ye,{class:"q-pt-none"},{default:c(()=>[r(Qe,{modelValue:$.value,"onUpdate:modelValue":t[10]||(t[10]=e=>$.value=e),options:Me.value,label:"Sub-Task Name",outlined:"",dense:"","emit-value":"","map-options":"","option-label":"sub_task_name","option-value":"sub_task_name"},null,8,["modelValue","options"]),g.value?(u(),y("div",yn," Day: "+m(g.value.dayOffset)+" (relative to task start) ",1)):D("",!0)]),_:1}),r(Tt,{align:"right"},{default:c(()=>[je(r(E,{flat:"",label:"Cancel",color:"grey"},null,512),[[at]]),r(E,{flat:"",label:"Add",color:"primary",disable:!$.value||ne.value,loading:ne.value,onClick:Qt},null,8,["disable","loading"])]),_:1})]),_:1})]),_:1},8,["modelValue"])]),_:1}))}},wn=Pa(vn,[["__scopeId","data-v-566ee04e"]]);export{wn as default};
