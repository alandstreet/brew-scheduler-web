import{p as qe,l as V,z as S,B as ut,C as Ue,T as ct,D as mt,E as gt,F as vt,G as yt,H as He,s as pt,I as ft,r as v,J as _t,K as ht,L as pe,M as bt,g as oe,N as Ee,O as Oe,A as wt,P as Ne,R as kt,o as Dt,c as ue,a as y,w as _,b as l,h,d as r,i as Ae,e as se,j as N,Q as Pe,f as Qe,t as x,S as O,k as J,U as X,V as le,W as ve,X as xt,Y as St,Z as xe}from"./index-1eAz2ktz.js";import{Q as je,a as fe,b as ie,c as $,v as Tt,d as Bt,e as Se,f as Te,g as Ct,h as It}from"./v4-K6hrMq9M.js";import{Q as qt}from"./QPage-Diorea19.js";import{u as Vt}from"./use-quasar-C8PyycmI.js";const $t=["top","middle","bottom"],Ft=qe({name:"QBadge",props:{color:String,textColor:String,floating:Boolean,transparent:Boolean,multiLine:Boolean,outline:Boolean,rounded:Boolean,label:[Number,String],align:{type:String,validator:n=>$t.includes(n)}},setup(n,{slots:o}){const k=V(()=>n.align!==void 0?{verticalAlign:n.align}:null),g=V(()=>{const b=n.outline===!0&&n.color||n.textColor;return`q-badge flex inline items-center no-wrap q-badge--${n.multiLine===!0?"multi":"single"}-line`+(n.outline===!0?" q-badge--outline":n.color!==void 0?` bg-${n.color}`:"")+(b!==void 0?` text-${b}`:"")+(n.floating===!0?" q-badge--floating":"")+(n.rounded===!0?" q-badge--rounded":"")+(n.transparent===!0?" q-badge--transparent":"")});return()=>S("div",{class:g.value,style:k.value,role:"status","aria-label":n.label},ut(o.default,n.label!==void 0?[n.label]:[]))}}),Lt=qe({name:"QSlideTransition",props:{appear:Boolean,duration:{type:Number,default:300}},emits:["show","hide"],setup(n,{slots:o,emit:k}){let g=!1,b,p,w=null,D=null,T,A;function P(){b?.(),b=null,g=!1,w!==null&&(clearTimeout(w),w=null),D!==null&&(clearTimeout(D),D=null),p?.removeEventListener("transitionend",T),T=null}function C(u,B,I){B!==void 0&&(u.style.height=`${B}px`),u.style.transition=`height ${n.duration}ms cubic-bezier(.25, .8, .50, 1)`,g=!0,b=I}function H(u,B){u.style.overflowY=null,u.style.height=null,u.style.transition=null,P(),B!==A&&k(B)}function ee(u,B){let I=0;p=u,g===!0?(P(),I=u.offsetHeight===u.scrollHeight?0:void 0):(A="hide",u.style.overflowY="hidden"),C(u,I,B),w=setTimeout(()=>{w=null,u.style.height=`${u.scrollHeight}px`,T=q=>{D=null,(Object(q)!==q||q.target===u)&&H(u,"show")},u.addEventListener("transitionend",T),D=setTimeout(T,n.duration*1.1)},100)}function te(u,B){let I;p=u,g===!0?P():(A="show",u.style.overflowY="hidden",I=u.scrollHeight),C(u,I,B),w=setTimeout(()=>{w=null,u.style.height=0,T=q=>{D=null,(Object(q)!==q||q.target===u)&&H(u,"hide")},u.addEventListener("transitionend",T),D=setTimeout(T,n.duration*1.1)},100)}return Ue(()=>{g===!0&&P()}),()=>S(ct,{css:!1,appear:n.appear,onEnter:ee,onLeave:te},o.default)}}),Z=mt({}),Mt=Object.keys(He),Nt=qe({name:"QExpansionItem",props:{...He,...yt,...vt,icon:String,label:String,labelLines:[Number,String],caption:String,captionLines:[Number,String],dense:Boolean,toggleAriaLabel:String,expandIcon:String,expandedIcon:String,expandIconClass:[Array,String,Object],duration:{},headerInsetLevel:Number,contentInsetLevel:Number,expandSeparator:Boolean,defaultOpened:Boolean,hideExpandIcon:Boolean,expandIconToggle:Boolean,switchToggleSide:Boolean,denseToggle:Boolean,group:String,popup:Boolean,headerStyle:[Array,String,Object],headerClass:[Array,String,Object]},emits:[...gt,"click","afterShow","afterHide"],setup(n,{slots:o,emit:k}){const{proxy:{$q:g}}=pt(),b=ft(n,g),p=v(n.modelValue!==null?n.modelValue:n.defaultOpened),w=v(null),D=_t(),{show:T,hide:A,toggle:P}=ht({showing:p});let C,H;const ee=V(()=>`q-expansion-item q-item-type q-expansion-item--${p.value===!0?"expanded":"collapsed"} q-expansion-item--${n.popup===!0?"popup":"standard"}`),te=V(()=>n.contentInsetLevel===void 0?null:{["padding"+(g.lang.rtl===!0?"Right":"Left")]:n.contentInsetLevel*56+"px"}),u=V(()=>n.disable!==!0&&(n.href!==void 0||n.to!==void 0&&n.to!==null&&n.to!=="")),B=V(()=>{const d={};return Mt.forEach(L=>{d[L]=n[L]}),d}),I=V(()=>u.value===!0||n.expandIconToggle!==!0),q=V(()=>n.expandedIcon!==void 0&&p.value===!0?n.expandedIcon:n.expandIcon||g.iconSet.expansionItem[n.denseToggle===!0?"denseIcon":"icon"]),re=V(()=>n.disable!==!0&&(u.value===!0||n.expandIconToggle===!0)),E=V(()=>({expanded:p.value===!0,detailsId:D.value,toggle:P,show:T,hide:A})),W=V(()=>{const d=n.toggleAriaLabel!==void 0?n.toggleAriaLabel:g.lang.label[p.value===!0?"collapse":"expand"](n.label);return{role:"button","aria-expanded":p.value===!0?"true":"false","aria-controls":D.value,"aria-label":d}});pe(()=>n.group,d=>{H?.(),d!==void 0&&me()});function Q(d){u.value!==!0&&P(d),k("click",d)}function Y(d){d.keyCode===13&&j(d,!0)}function j(d,L){L!==!0&&d.qAvoidFocus!==!0&&w.value?.focus(),P(d),kt(d)}function ae(){k("afterShow")}function _e(){k("afterHide")}function me(){C===void 0&&(C=bt()),p.value===!0&&(Z[n.group]=C);const d=pe(p,R=>{R===!0?Z[n.group]=C:Z[n.group]===C&&delete Z[n.group]}),L=pe(()=>Z[n.group],(R,de)=>{de===C&&R!==void 0&&R!==C&&A()});H=()=>{d(),L(),Z[n.group]===C&&delete Z[n.group],H=void 0}}function ge(){const d={class:[`q-focusable relative-position cursor-pointer${n.denseToggle===!0&&n.switchToggleSide===!0?" items-end":""}`,n.expandIconClass],side:n.switchToggleSide!==!0,avatar:n.switchToggleSide},L=[S(Ne,{class:"q-expansion-item__toggle-icon"+(n.expandedIcon===void 0&&p.value===!0?" q-expansion-item__toggle-icon--rotated":""),name:q.value})];return re.value===!0&&(Object.assign(d,{tabindex:0,...W.value,onClick:j,onKeyup:Y}),L.unshift(S("div",{ref:w,class:"q-expansion-item__toggle-focus q-icon q-focus-helper q-focus-helper--rounded",tabindex:-1}))),S(ie,d,()=>L)}function he(){let d;return o.header!==void 0?d=[].concat(o.header(E.value)):(d=[S(ie,()=>[S(fe,{lines:n.labelLines},()=>n.label||""),n.caption?S(fe,{lines:n.captionLines,caption:!0},()=>n.caption):null])],n.icon&&d[n.switchToggleSide===!0?"push":"unshift"](S(ie,{side:n.switchToggleSide===!0,avatar:n.switchToggleSide!==!0},()=>S(Ne,{name:n.icon})))),n.disable!==!0&&n.hideExpandIcon!==!0&&d[n.switchToggleSide===!0?"unshift":"push"](ge()),d}function be(){const d={ref:"item",style:n.headerStyle,class:n.headerClass,dark:b.value,disable:n.disable,dense:n.dense,insetLevel:n.headerInsetLevel};return I.value===!0&&(d.clickable=!0,d.onClick=Q,Object.assign(d,u.value===!0?B.value:W.value)),S(je,d,he)}function we(){return Ee(S("div",{key:"e-content",class:"q-expansion-item__content relative-position",style:te.value,id:D.value},wt(o.default)),[[Oe,p.value]])}function F(){const d=[be(),S(Lt,{duration:n.duration,onShow:ae,onHide:_e},we)];return n.expandSeparator===!0&&d.push(S(oe,{class:"q-expansion-item__border q-expansion-item__border--top absolute-top",dark:b.value}),S(oe,{class:"q-expansion-item__border q-expansion-item__border--bottom absolute-bottom",dark:b.value})),d}return n.group!==void 0&&me(),Ue(()=>{H?.()}),()=>S("div",{class:ee.value},[S("div",{class:"q-expansion-item__container relative-position"},F())])}}),ce="/api/beers",K={async getAll(){return(await $.get(ce)).data.beers||[]},async getById(n){return(await $.get(`${ce}/${n}`)).data.beer},async create(n){const o={beer_template_id:n.beer_template_id,name:n.name,batch_id:n.batch_id,volume_hl:n.volume_hl,priority:n.priority,min_fermentation_days:n.min_fermentation_days,min_maturation_days:n.min_maturation_days,target_start_date:n.target_start_date,target_completion_date:n.target_completion_date};await $.post(ce,o)},async update(n,o){const k={beer_id:o.beer_id,beer_template_id:o.beer_template_id||null,name:o.name,batch_id:o.batch_id||null,volume_hl:o.volume_hl,priority:o.priority,min_fermentation_days:o.min_fermentation_days,min_maturation_days:o.min_maturation_days||0,target_start_date:o.target_start_date||null,target_completion_date:o.target_completion_date||null,requires_canning:o.requires_canning||!1,tasks:o.tasks||[]};await $.put(`${ce}/${n}`,k)},async delete(n){await $.delete(`${ce}/${n}`)}},Be="/api/canning-days",Ce={async getAll(){return(await $.get(Be)).data.canning_days||[]},async create(n){await $.post(Be,{canning_day:n})},async delete(n){await $.delete(`${Be}/${n}`)}},ye="/api/tasks",Ie={async getById(n){return(await $.get(`${ye}/${n}`)).data.task},async create(n){const o=Tt();return(await $.post(ye,{task_id:o,...n,locked:!0})).data},async delete(n){await $.delete(`${ye}/${n}`)},async adjustDuration(n,o){return(await $.put(`${ye}/${n}/duration/${o}`)).data.tasks||[]}},At=(n,o)=>{const k=n.__vccOpts||n;for(const[g,b]of o)k[g]=b;return k},Pt={class:"row no-wrap",style:{height:"100%"}},Qt={class:"col-3 q-pa-md",style:{"border-right":"1px solid #e0e0e0","overflow-y":"auto"}},Ut={key:0,class:"flex flex-center q-pa-md"},Ht={key:1},Et={class:"text-subtitle2 text-primary"},Ot={class:"text-caption"},jt={class:"row q-gutter-sm q-mb-md"},Rt={key:1,class:"canning-days-list q-mb-md"},zt={key:2,class:"text-grey-6 text-center q-pa-sm"},Kt={class:"row items-center justify-between q-mb-md"},Wt={key:3,class:"flex flex-center q-pa-md"},Yt={class:"row items-center justify-between q-mb-sm"},Gt={class:"beer-details"},Jt={class:"detail-row"},Xt={class:"detail-row"},Zt={class:"detail-row"},ea={class:"detail-row"},ta={class:"detail-row"},aa={class:"detail-row"},na={class:"detail-row"},sa={key:0,class:"q-mt-md"},la={class:"task-type-label"},oa={key:5,class:"text-center text-grey-7 q-pa-md"},ia={class:"col-9 q-pa-md"},ra={class:"row items-center justify-between q-mb-md"},da={class:"row items-center q-gutter-sm"},ua={class:"text-h6"},ca={class:"schedule-table-container"},ma={class:"schedule-table"},ga={class:"date-label"},va=["onClick"],ya={key:0,class:"task-info"},pa={class:"task-name"},fa={key:0,class:"batch-id"},_a={class:"task-type"},ha=["onClick"],ba={key:0,class:"task-info"},wa={class:"task-name"},ka={key:0,class:"batch-id"},Da={class:"task-type"},xa={__name:"SchedulePage",setup(n){const o=Vt(),k=v([]),g=v(null),b=v(""),p=v(null),w=v(null),D=v(2),T=v(null),A=v(null),P=v(null),C=v(null),H=v(null),ee=v(null),te=v(null),u=v(null),B=v(!1),I=v(!1),q=v(!1),re=v(!1),E=v(new Date),W=v([]),Q=v([]),Y=v([]),j=v(null),ae=v(!1),_e=["F6","F5","F4","F3","F2","F1","B1","B2"];pe(g,a=>{a?(p.value=a.min_fermentation_days,w.value=a.min_maturation_days):(p.value=null,w.value=null)});const me=V(()=>{const a=new Date(E.value),t=new Date(E.value);return t.setDate(t.getDate()+29),`${a.toLocaleDateString("en-US",{month:"short",day:"numeric"})} - ${t.toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}`}),ge=V(()=>{const a=[],t=new Date;t.setHours(0,0,0,0);for(let e=0;e<30;e++){const s=new Date(E.value);s.setDate(s.getDate()+e),s.setHours(0,0,0,0);const i=he(s),c=s.getTime()===t.getTime(),M=s.getDay()===0||s.getDay()===6,ne=be(s);a.push({date:i,label:s.toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"}),isToday:c,isWeekend:M,isHoliday:ne,fullDate:new Date(s)})}return a}),he=a=>{const t=a.getFullYear(),e=String(a.getMonth()+1).padStart(2,"0"),s=String(a.getDate()).padStart(2,"0");return`${t}-${e}-${s}`},be=a=>{const t=a.getFullYear(),e=a.getMonth()+1,s=a.getDate();if(e===1&&s===1||e===1&&s===26||e===4&&s===25||e===12&&s===25||e===12&&s===26)return!0;if(e===5){const i=new Date(t,4,1);for(;i.getDay()!==1;)i.setDate(i.getDate()+1);if(s===i.getDate())return!0}if(e===6){const i=new Date(t,5,1);for(;i.getDay()!==1;)i.setDate(i.getDate()+1);const c=new Date(i);if(c.setDate(c.getDate()+7),s===c.getDate())return!0}if(e===8){const i=new Date(t,7,1);for(;i.getDay()!==3;)i.setDate(i.getDate()+1);const c=new Date(i);if(c.setDate(c.getDate()+14),s===c.getDate())return!0}return!1},we=async()=>{B.value=!0;try{k.value=await Bt.getAll()}catch(a){o.notify({type:"negative",message:"Failed to load beer templates",caption:a.response?.data?.message||a.message})}finally{B.value=!1}},F=async()=>{q.value=!0;try{const a=await K.getAll();W.value=a;const t=[];for(const e of a)e.tasks&&Array.isArray(e.tasks)&&t.push(...e.tasks);Q.value=t}catch(a){o.notify({type:"negative",message:"Failed to load beers",caption:a.response?.data?.message||a.message})}finally{q.value=!1}},d=async()=>{if(!(!g.value||!b.value||p.value===null||w.value===null||D.value===null)){I.value=!0;try{const a={beer_template_id:g.value.beer_template_id,name:g.value.beer_name,batch_id:b.value,volume_hl:g.value.volume_hl,priority:D.value,min_fermentation_days:p.value,min_maturation_days:w.value,target_start_date:T.value||null,target_completion_date:A.value||null};await K.create(a),o.notify({type:"positive",message:"Beer created successfully",caption:`${a.name} ${a.batch_id}`,icon:"local_drink"}),g.value=null,b.value="",p.value=null,w.value=null,D.value=2,T.value=null,A.value=null,P.value?.resetValidation(),C.value?.resetValidation(),H.value?.resetValidation(),ee.value?.resetValidation(),te.value?.resetValidation(),u.value?.resetValidation(),await F()}catch(a){o.notify({type:"negative",message:"Failed to create beer",caption:a.response?.data?.message||a.message})}finally{I.value=!1}}},L=[[229,57,53],[30,136,229],[67,160,71],[251,140,0],[142,36,170],[0,172,193],[255,179,0],[109,76,65],[216,27,96],[57,73,171],[0,137,123],[124,179,66],[244,81,30],[94,53,177],[3,155,229],[192,202,51]],R=new Map,de=(a,t=!1)=>{if(!R.has(a)){const ne=R.size%L.length;R.set(a,ne)}const e=R.get(a),[s,i,c]=L[e];return`rgba(${s}, ${i}, ${c}, ${t?.4:.2})`},Re=async()=>{re.value=!0;try{const a=new Date;a.setDate(a.getDate()+1),a.setHours(0,0,0,0);const t=m=>{const z=new Date(m);z.setHours(0,0,0,0);const U=z.getTime()-a.getTime();return Math.floor(U/(1e3*60*60*24))},e=m=>m?t(m):null,s=[],i=[],c=[];for(const m of W.value){const z=(m.tasks||[]).filter(U=>U.locked);if(z.length>0){s.push(m);for(const U of z)c.push({resource:U.resource,start_day:Math.max(0,t(U.start_date)),end_day:Math.max(0,t(U.end_date))})}else i.push({id:m.beer_id,name:m.name,volume_hl:m.volume_hl,priority:m.priority,min_fermentation_days:m.min_fermentation_days,min_maturation_days:m.min_maturation_days||0,requires_canning:m.requires_canning||!1,target_completion_day:e(m.target_completion_date),tasks:[]})}const M={beers:i,canning_days:Y.value};c.length>0&&(M.resource_blocks=c);const De=(await $.post("/api/schedule",M)).data.schedule?.beers||[],G=[];for(const m of De)if(m.tasks&&Array.isArray(m.tasks))for(const z of m.tasks)G.push({...z,beer_id:m.beer_id,beer_name:m.name,batch_id:m.batch_id});for(const m of s){const z=(m.tasks||[]).filter(U=>U.locked);for(const U of z)G.push({...U,beer_id:m.beer_id,beer_name:m.name,batch_id:m.batch_id})}Q.value=G,o.notify({type:"positive",message:"Beers scheduled successfully",icon:"calendar_today"})}catch(a){console.error("Schedule error:",a),o.notify({type:"negative",message:"Failed to schedule beers",caption:a.response?.data?.message||a.message})}finally{re.value=!1}},f=(a,t)=>{const e=t.toLowerCase();return Q.value.filter(s=>{if(s.resource.toLowerCase()!==e)return!1;const i=new Date(s.start_date),c=new Date(s.end_date),M=new Date(a);return i.setHours(0,0,0,0),c.setHours(0,0,0,0),M.setHours(0,0,0,0),M>=i&&M<=c})},Ve=(a,t)=>{const e=new Date(t.start_date),s=new Date(t.end_date),i=new Date(a);e.setHours(0,0,0,0),s.setHours(0,0,0,0),i.setHours(0,0,0,0);const c=i.getTime()===e.getTime(),M=i.getTime()===s.getTime(),ne=Math.round((s-e)/(1e3*60*60*24))+1,De=Math.floor(ne/2),G=new Date(e);G.setDate(G.getDate()+De);const m=i.getTime()===G.getTime();return{isFirst:c,isLast:M,isMiddle:m,isSingle:c&&M}},$e=(a,t)=>{const e=Ve(a,t);return e.isMiddle||e.isSingle},Fe=a=>Q.value.filter(t=>t.beer_id===a),ze=async(a,t,e)=>{try{if(e){const s=await Ie.create({beer_id:a.beer_id,beer_name:a.name,task_type:t.task_type,start_day:t.start_day,start_date:t.start_date,duration:t.duration,end_day:t.end_day,end_date:t.end_date,resource:t.resource,volume_hl:a.volume_hl}),i=Q.value.findIndex(c=>c.beer_id===a.beer_id&&c.task_type===t.task_type);i!==-1&&(Q.value[i]={...Q.value[i],task_id:s.task_id,locked:!0}),o.notify({type:"positive",message:"Task pinned",caption:`${t.task_type} for ${a.name}`,icon:"push_pin"})}else if(t.task_id){await Ie.delete(t.task_id);const s=Q.value.findIndex(i=>i.beer_id===a.beer_id&&i.task_type===t.task_type);s!==-1&&Q.value.splice(s,1),o.notify({type:"positive",message:"Task unpinned",caption:`${t.task_type} for ${a.name}`,icon:"push_pin"})}}catch(s){o.notify({type:"negative",message:e?"Failed to pin task":"Failed to unpin task",caption:s.response?.data?.message||s.message})}},Le=(a,t)=>{const e=f(a.date,t),s=e.length>0,i={today:a.isToday,weekend:a.isWeekend,holiday:a.isHoliday,"has-task":s};if(s){const c=Ve(a.date,e[0]);i["task-first"]=c.isFirst&&!c.isSingle,i["task-last"]=c.isLast&&!c.isSingle,i["task-middle"]=!c.isFirst&&!c.isLast,i["task-single"]=c.isSingle}return i},Ke=a=>{o.notify({type:"info",message:`Viewing ${a.name}`,caption:"Feature coming soon..."})},Me=async(a,t)=>{if(t)if(t.locked&&t.task_id&&(a.metaKey||a.ctrlKey)){const e=a.shiftKey?-1:1;try{await Ie.adjustDuration(t.task_id,e),o.notify({type:"positive",message:`Task duration ${e>0?"increased":"decreased"} by 1 day`,icon:"schedule"}),await F()}catch(s){o.notify({type:"negative",message:"Failed to adjust task duration",caption:s.response?.data?.message||s.message})}}else Ke(t)},We=a=>{o.dialog({title:"Confirm Delete",message:`Are you sure you want to delete ${a.name} (${a.batch_id})?`,cancel:!0,persistent:!0}).onOk(async()=>{await Ye(a.beer_id)})},Ye=async a=>{try{await K.delete(a),o.notify({type:"positive",message:"Beer deleted successfully",icon:"delete"}),await F()}catch(t){o.notify({type:"negative",message:"Failed to delete beer",caption:t.response?.data?.message||t.message})}},Ge=async(a,t)=>{try{const e=Number(t);if(isNaN(e)||e<=0){o.notify({type:"negative",message:"Invalid volume",caption:"Must be greater than 0"});return}const s={...a,volume_hl:e};await K.update(a.beer_id,s),o.notify({type:"positive",message:"Volume updated successfully",icon:"check"}),await F()}catch(e){o.notify({type:"negative",message:"Failed to update volume",caption:e.response?.data?.message||e.message})}},Je=async(a,t)=>{try{const e={...a,priority:t};await K.update(a.beer_id,e),o.notify({type:"positive",message:"Priority updated successfully",icon:"check"}),await F()}catch(e){o.notify({type:"negative",message:"Failed to update priority",caption:e.response?.data?.message||e.message})}},Xe=async(a,t)=>{try{const e=Number(t);if(isNaN(e)||e<0){o.notify({type:"negative",message:"Invalid fermentation days",caption:"Must be 0 or greater"});return}const s={...a,min_fermentation_days:e};await K.update(a.beer_id,s),o.notify({type:"positive",message:"Min fermentation days updated successfully",icon:"check"}),await F()}catch(e){o.notify({type:"negative",message:"Failed to update min fermentation days",caption:e.response?.data?.message||e.message})}},Ze=async(a,t)=>{try{const e={...a,target_start_date:t||null};await K.update(a.beer_id,e),o.notify({type:"positive",message:"Target start date updated successfully",icon:"check"}),await F()}catch(e){o.notify({type:"negative",message:"Failed to update target start date",caption:e.response?.data?.message||e.message})}},et=async(a,t)=>{try{const e={...a,target_completion_date:t||null};await K.update(a.beer_id,e),o.notify({type:"positive",message:"Target completion date updated successfully",icon:"check"}),await F()}catch(e){o.notify({type:"negative",message:"Failed to update target completion date",caption:e.response?.data?.message||e.message})}},tt=async(a,t)=>{try{const e={...a,requires_canning:t};await K.update(a.beer_id,e),o.notify({type:"positive",message:"Requires canning updated successfully",icon:"check"}),await F()}catch(e){o.notify({type:"negative",message:"Failed to update requires canning",caption:e.response?.data?.message||e.message})}},at=()=>{const a=new Date(E.value);a.setDate(a.getDate()-30),E.value=a},nt=()=>{const a=new Date(E.value);a.setDate(a.getDate()+30),E.value=a},st=()=>{E.value=new Date},lt=a=>{switch(a){case 5:return"red";case 4:return"orange";case 3:return"amber";case 2:return"blue";case 1:return"grey";default:return"grey"}},ke=async()=>{try{Y.value=await Ce.getAll()}catch(a){console.error("Failed to load canning days:",a)}},ot=a=>Y.value.includes(a),it=async()=>{if(j.value){ae.value=!0;try{await Ce.create(j.value),await ke(),j.value=null,o.notify({type:"positive",message:"Canning day added",icon:"event"})}catch(a){o.notify({type:"negative",message:"Failed to add canning day",caption:a.response?.data?.message||a.message})}finally{ae.value=!1}}},rt=async a=>{try{await Ce.delete(a),await ke(),o.notify({type:"positive",message:"Canning day removed",icon:"event_busy"})}catch(t){o.notify({type:"negative",message:"Failed to remove canning day",caption:t.response?.data?.message||t.message})}},dt=a=>new Date(a).toLocaleDateString("en-US",{weekday:"short",month:"short",day:"numeric"});return Dt(async()=>{await Promise.all([we(),F(),ke()])}),(a,t)=>(y(),ue(qt,{class:"schedule-page"},{default:_(()=>[l("div",Pt,[l("div",Qt,[t[25]||(t[25]=l("div",{class:"text-h5 q-mb-md"},"Create Beer",-1)),B.value?(y(),h("div",Ut,[r(Ae,{color:"primary",size:"md"})])):(y(),h("div",Ht,[r(Se,{modelValue:g.value,"onUpdate:modelValue":t[0]||(t[0]=e=>g.value=e),options:k.value,"option-label":"beer_name","option-value":"beer_template_id",label:"Select Beer Template",outlined:"",disable:k.value.length===0},{"no-option":_(()=>[r(je,null,{default:_(()=>[r(ie,{class:"text-grey"},{default:_(()=>[...t[8]||(t[8]=[N(" No templates available ",-1)])]),_:1})]),_:1})]),_:1},8,["modelValue","options","disable"]),g.value?(y(),ue(Pe,{key:0,flat:"",bordered:"",class:"q-mt-md"},{default:_(()=>[r(Qe,null,{default:_(()=>[l("div",Et,x(g.value.beer_name),1),r(oe,{class:"q-my-sm"}),l("div",Ot,[l("div",null,[t[9]||(t[9]=l("strong",null,"Volume:",-1)),N(" "+x(g.value.volume_hl)+" hl",1)]),l("div",null,[t[10]||(t[10]=l("strong",null,"Maturation:",-1)),N(" "+x(g.value.min_maturation_days)+" days",1)])]),r(oe,{class:"q-my-sm"}),r(O,{ref_key:"batchIdInput",ref:P,modelValue:b.value,"onUpdate:modelValue":t[1]||(t[1]=e=>b.value=e),label:"Batch ID *",outlined:"",dense:"",class:"q-mt-sm",rules:[e=>!!e||"Batch ID is required"]},null,8,["modelValue","rules"]),r(O,{ref_key:"minFermentationDaysInput",ref:C,modelValue:p.value,"onUpdate:modelValue":t[2]||(t[2]=e=>p.value=e),modelModifiers:{number:!0},label:"Min Fermentation Days *",type:"number",outlined:"",dense:"",class:"q-mt-sm",rules:[e=>e!==null&&e!==""&&e!==void 0||"Min fermentation days is required",e=>e>=0||"Must be 0 or greater"]},null,8,["modelValue","rules"]),r(O,{ref_key:"minMaturationDaysInput",ref:H,modelValue:w.value,"onUpdate:modelValue":t[3]||(t[3]=e=>w.value=e),modelModifiers:{number:!0},label:"Min Maturation Days *",type:"number",outlined:"",dense:"",class:"q-mt-sm",rules:[e=>e!==null&&e!==""&&e!==void 0||"Min maturation days is required",e=>e>=0||"Must be 0 or greater"]},null,8,["modelValue","rules"]),r(Se,{ref_key:"priorityInput",ref:ee,modelValue:D.value,"onUpdate:modelValue":t[4]||(t[4]=e=>D.value=e),options:[1,2,3],label:"Priority *",outlined:"",dense:"",class:"q-mt-sm",rules:[e=>e!=null||"Priority is required"]},null,8,["modelValue","rules"]),r(O,{ref_key:"targetStartDateInput",ref:te,modelValue:T.value,"onUpdate:modelValue":t[5]||(t[5]=e=>T.value=e),label:"Target Start Date",outlined:"",dense:"",type:"date",class:"q-mt-sm"},null,8,["modelValue"]),r(O,{ref_key:"targetDateInput",ref:u,modelValue:A.value,"onUpdate:modelValue":t[6]||(t[6]=e=>A.value=e),label:"Target Completion Date",outlined:"",dense:"",type:"date",class:"q-mt-sm"},null,8,["modelValue"]),r(J,{color:"primary",icon:"add",label:"Create Beer",class:"full-width q-mt-md",disable:!b.value||p.value===null||w.value===null||D.value===null||I.value,loading:I.value,onClick:d},null,8,["disable","loading"])]),_:1})]),_:1})):se("",!0),r(oe,{class:"q-my-md"}),t[24]||(t[24]=l("div",{class:"text-h6 q-mb-md"},"Canning Days",-1)),l("div",jt,[r(O,{modelValue:j.value,"onUpdate:modelValue":t[7]||(t[7]=e=>j.value=e),type:"date",label:"Add Canning Day",outlined:"",dense:"",class:"col"},null,8,["modelValue"]),r(J,{color:"primary",icon:"add",disable:!j.value||ae.value,loading:ae.value,onClick:it},{default:_(()=>[r(Te,null,{default:_(()=>[...t[11]||(t[11]=[N("Add Canning Day",-1)])]),_:1})]),_:1},8,["disable","loading"])]),Y.value.length>0?(y(),h("div",Rt,[(y(!0),h(X,null,le(Y.value,e=>(y(),ue(Ct,{key:e,removable:"",color:"red","text-color":"white",onRemove:s=>rt(e)},{default:_(()=>[N(x(dt(e)),1)]),_:2},1032,["onRemove"]))),128))])):(y(),h("div",zt," No canning days scheduled ")),r(oe,{class:"q-my-md"}),l("div",Kt,[t[13]||(t[13]=l("div",{class:"text-h6"},"Batches",-1)),r(J,{flat:"",dense:"",round:"",icon:"calendar_today",size:"sm",color:"primary",loading:re.value,onClick:Re},{default:_(()=>[r(Te,null,{default:_(()=>[...t[12]||(t[12]=[N("Schedule Beers",-1)])]),_:1})]),_:1},8,["loading"])]),q.value?(y(),h("div",Wt,[r(Ae,{color:"primary",size:"md"})])):W.value.length>0?(y(),ue(It,{key:4},{default:_(()=>[(y(!0),h(X,null,le(W.value,e=>(y(),ue(Nt,{key:e.beer_id,"expand-separator":"",class:"color-indicator",style:ve({backgroundColor:de(e.beer_id)})},{header:_(()=>[r(ie,null,{default:_(()=>[r(fe,null,{default:_(()=>[N(x(e.name),1)]),_:2},1024),r(fe,{caption:""},{default:_(()=>[N(x(e.batch_id),1)]),_:2},1024)]),_:2},1024),r(ie,{side:""},{default:_(()=>[r(Ft,{color:lt(e.priority)},{default:_(()=>[N(" P"+x(e.priority),1)]),_:2},1032,["color"])]),_:2},1024)]),default:_(()=>[r(Pe,{flat:""},{default:_(()=>[r(Qe,{class:"q-pt-none"},{default:_(()=>[l("div",Yt,[t[15]||(t[15]=l("div",{class:"text-subtitle2"},"Beer Details",-1)),r(J,{flat:"",dense:"",round:"",icon:"delete",color:"negative",size:"sm",onClick:s=>We(e)},{default:_(()=>[r(Te,null,{default:_(()=>[...t[14]||(t[14]=[N("Delete Beer",-1)])]),_:1})]),_:1},8,["onClick"])]),l("div",Gt,[l("div",Jt,[t[16]||(t[16]=l("span",{class:"detail-label"},"Batch ID:",-1)),l("span",null,x(e.batch_id),1)]),l("div",Xt,[t[17]||(t[17]=l("span",{class:"detail-label"},"Volume:",-1)),r(O,{"model-value":e.volume_hl,type:"number",suffix:"hl",dense:"",outlined:"",style:{"max-width":"100px"},rules:[s=>s>0||"Must be greater than 0"],"onUpdate:modelValue":s=>Ge(e,s)},null,8,["model-value","rules","onUpdate:modelValue"])]),l("div",Zt,[t[18]||(t[18]=l("span",{class:"detail-label"},"Priority:",-1)),r(Se,{"model-value":e.priority,options:[1,2,3],dense:"",outlined:"",style:{"max-width":"80px"},"onUpdate:modelValue":s=>Je(e,s)},null,8,["model-value","onUpdate:modelValue"])]),l("div",ea,[t[19]||(t[19]=l("span",{class:"detail-label"},"Min Fermentation:",-1)),r(O,{"model-value":e.min_fermentation_days,type:"number",suffix:"days",dense:"",outlined:"",style:{"max-width":"120px"},rules:[s=>s>=0||"Must be 0 or greater"],onChange:s=>Xe(e,s.target.value)},null,8,["model-value","rules","onChange"])]),l("div",ta,[t[20]||(t[20]=l("span",{class:"detail-label"},"Target Start:",-1)),r(O,{"model-value":e.target_start_date||"",type:"date",dense:"",outlined:"",style:{"max-width":"150px"},"onUpdate:modelValue":s=>Ze(e,s)},null,8,["model-value","onUpdate:modelValue"])]),l("div",aa,[t[21]||(t[21]=l("span",{class:"detail-label"},"Target Completion:",-1)),r(O,{"model-value":e.target_completion_date||"",type:"date",dense:"",outlined:"",style:{"max-width":"150px"},"onUpdate:modelValue":s=>et(e,s)},null,8,["model-value","onUpdate:modelValue"])]),l("div",na,[t[22]||(t[22]=l("span",{class:"detail-label"},"Requires Canning:",-1)),r(xt,{"model-value":e.requires_canning||!1,dense:"","onUpdate:modelValue":s=>tt(e,s)},null,8,["model-value","onUpdate:modelValue"])])]),Fe(e.beer_id).length>0?(y(),h("div",sa,[t[23]||(t[23]=l("div",{class:"text-subtitle2 q-mb-sm"},"Scheduled Tasks",-1)),(y(!0),h(X,null,le(Fe(e.beer_id),s=>(y(),h("div",{key:`${e.beer_id}-${s.task_type}`,class:"task-row"},[l("span",la,x(s.task_type),1),r(St,{"model-value":s.locked||!1,label:"Pin",dense:"",size:"sm","onUpdate:modelValue":i=>ze(e,s,i)},null,8,["model-value","onUpdate:modelValue"])]))),128))])):se("",!0)]),_:2},1024)]),_:2},1024)]),_:2},1032,["style"]))),128))]),_:1})):(y(),h("div",oa," No beers scheduled yet "))]))]),l("div",ia,[l("div",ra,[t[26]||(t[26]=l("div",{class:"text-h4"},"Schedule",-1)),l("div",da,[r(J,{flat:"",dense:"",round:"",icon:"chevron_left",onClick:at}),l("div",ua,x(me.value),1),r(J,{flat:"",dense:"",round:"",icon:"chevron_right",onClick:nt}),r(J,{flat:"",label:"Today",onClick:st})])]),l("div",ca,[l("div",ma,[t[27]||(t[27]=l("div",{class:"schedule-header"},"Date",-1)),t[28]||(t[28]=l("div",{class:"schedule-header"},"Brewhouse",-1)),t[29]||(t[29]=l("div",{class:"schedule-header"},[l("div",null,"F6"),l("div",{class:"volume-label"},"20hl")],-1)),t[30]||(t[30]=l("div",{class:"schedule-header"},[l("div",null,"F5"),l("div",{class:"volume-label"},"20hl")],-1)),t[31]||(t[31]=l("div",{class:"schedule-header"},[l("div",null,"F4"),l("div",{class:"volume-label"},"20hl")],-1)),t[32]||(t[32]=l("div",{class:"schedule-header"},[l("div",null,"F3"),l("div",{class:"volume-label"},"20hl")],-1)),t[33]||(t[33]=l("div",{class:"schedule-header"},[l("div",null,"F2"),l("div",{class:"volume-label"},"10hl")],-1)),t[34]||(t[34]=l("div",{class:"schedule-header"},[l("div",null,"F1"),l("div",{class:"volume-label"},"10hl")],-1)),t[35]||(t[35]=l("div",{class:"schedule-header"},[l("div",null,"B1"),l("div",{class:"volume-label"},"10hl")],-1)),t[36]||(t[36]=l("div",{class:"schedule-header"},[l("div",null,"B2"),l("div",{class:"volume-label"},"20hl")],-1)),(y(!0),h(X,null,le(ge.value,e=>(y(),h(X,{key:e.date},[l("div",{class:xe(["schedule-cell date-cell",{today:e.isToday,weekend:e.isWeekend,holiday:e.isHoliday}])},[l("div",ga,x(e.label),1)],2),l("div",{class:xe(["schedule-cell tank-cell",Le(e,"Brewhouse")]),style:ve(f(e.date,"Brewhouse").length>0?{backgroundColor:de(f(e.date,"Brewhouse")[0].beer_id,f(e.date,"Brewhouse")[0].locked)}:{}),onClick:s=>f(e.date,"Brewhouse").length>0?Me(s,f(e.date,"Brewhouse")[0]):null},[f(e.date,"Brewhouse").length>0&&$e(e.date,f(e.date,"Brewhouse")[0])?(y(),h("div",ya,[l("div",pa,[N(x(f(e.date,"Brewhouse")[0].beer_name)+" ",1),f(e.date,"Brewhouse")[0].batch_id?(y(),h("span",fa,x(f(e.date,"Brewhouse")[0].batch_id),1)):se("",!0)]),l("div",_a,x(f(e.date,"Brewhouse")[0].task_type),1)])):se("",!0)],14,va),(y(),h(X,null,le(_e,s=>l("div",{key:`${e.date}-${s}`,class:xe(["schedule-cell tank-cell",Le(e,s)]),style:ve(f(e.date,s).length>0?{backgroundColor:de(f(e.date,s)[0].beer_id,f(e.date,s)[0].locked)}:{}),onClick:i=>f(e.date,s).length>0?Me(i,f(e.date,s)[0]):null},[f(e.date,s).length>0&&$e(e.date,f(e.date,s)[0])?(y(),h("div",ba,[l("div",wa,[N(x(f(e.date,s)[0].beer_name)+" ",1),f(e.date,s)[0].batch_id?(y(),h("span",ka,x(f(e.date,s)[0].batch_id),1)):se("",!0)]),l("div",Da,x(f(e.date,s)[0].task_type),1)])):se("",!0)],14,ha)),64))],64))),128))]),(y(!0),h(X,null,le(ge.value,(e,s)=>Ee((y(),h("div",{key:"canning-"+e.date,class:"canning-day-overlay",style:ve({top:`calc(${s} * 36px + 57px)`})},null,4)),[[Oe,ot(e.date)]])),128))])])])]),_:1}))}},Ia=At(xa,[["__scopeId","data-v-11761a64"]]);export{Ia as default};
